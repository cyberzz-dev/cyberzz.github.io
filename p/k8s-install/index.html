<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='install k8s'>
<title>Kubernetes</title>

<link rel='canonical' href='https://cyberzz.dev/p/k8s-install/'>

<link rel="stylesheet" href="/scss/style.min.24ef1cc321916467896e8c70c10c0ad7b98c2a8df14298032fb637216e397f50.css"><meta property='og:title' content='Kubernetes'>
<meta property='og:description' content='install k8s'>
<meta property='og:url' content='https://cyberzz.dev/p/k8s-install/'>
<meta property='og:site_name' content='Cyberzz&#39;s Blog Site'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2023-09-09T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-09-09T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Kubernetes">
<meta name="twitter:description" content="install k8s">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8XMXD5ZSFE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-8XMXD5ZSFE', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huda2458f72ce188392d75c5d51cd8e24e_373_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Cyberzz&#39;s Blog Site</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/cyberzz-dev'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://cyberzz.dev/" selected>English</option>
                        
                            <option value="https://cyberzz.dev/zh-cn/" >ä¸­æ–‡</option>
                        
                            <option value="https://cyberzz.dev/ar/" >Ø¹Ø±Ø¨ÙŠ</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#service-monitor-æ— æ³•å‘ç°">service monitor æ— æ³•å‘ç°</a></li>
    <li><a href="#11-ç³»ç»Ÿé…ç½®">1.1 ç³»ç»Ÿé…ç½®</a>
      <ol>
        <li><a href="#ä¿®æ”¹hosts">ä¿®æ”¹hosts</a></li>
        <li><a href="#å…³é—­é˜²ç«å¢™">å…³é—­é˜²ç«å¢™</a></li>
        <li><a href="#å…³é—­-selinux">å…³é—­ selinux</a></li>
        <li><a href="#å¿…é¡»å®‰è£…iptables">å¿…é¡»å®‰è£…iptables</a></li>
        <li><a href="#åˆ›å»ºetcmodules-loaddcontainerdconfé…ç½®æ–‡ä»¶">åˆ›å»º/etc/modules-load.d/containerd.confé…ç½®æ–‡ä»¶:</a></li>
      </ol>
    </li>
    <li><a href="#12-åŠ è½½å†…æ ¸modules-ipvs">1.2 åŠ è½½å†…æ ¸modules ipvs</a></li>
    <li><a href="#13-docker">1.3 docker</a>
      <ol>
        <li><a href="#å®‰è£…docker">å®‰è£…Docker</a></li>
        <li><a href="#å®‰è£…cri-dockerd">å®‰è£…cri-dockerd</a></li>
        <li><a href="#æ·»åŠ é˜¿é‡Œäº‘yumè½¯ä»¶æº">æ·»åŠ é˜¿é‡Œäº‘YUMè½¯ä»¶æº</a></li>
        <li><a href="#å®‰è£…kubeadmkubeletå’Œkubectl">å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</a></li>
      </ol>
    </li>
    <li><a href="#14--containerdrunc">1.4  Containerdã€runc</a></li>
  </ol>

  <ol>
    <li><a href="#21-å®‰è£…kubeadmå’Œkubelet">2.1 å®‰è£…kubeadmå’Œkubelet</a></li>
    <li><a href="#22-kubeadm-initåˆå§‹åŒ–">2.2 kubeadm initåˆå§‹åŒ–</a></li>
    <li><a href="#22-kubeadm-reset">2.2 kubeadm reset</a></li>
    <li><a href="#23-å®‰è£…helm-3">2.3 å®‰è£…helm 3</a></li>
    <li><a href="#24-éƒ¨ç½²networkç»„ä»¶calico">2.4 éƒ¨ç½²Networkç»„ä»¶Calico</a>
      <ol>
        <li>
          <ol>
            <li><a href="#install-calico">Install Calico</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#24-éƒ¨ç½²networkç»„ä»¶kube-ovn">2.4 éƒ¨ç½²Networkç»„ä»¶kube-ovn</a></li>
    <li><a href="#25-éªŒè¯k8s-dnsæ˜¯å¦å¯ç”¨">2.5 éªŒè¯k8s DNSæ˜¯å¦å¯ç”¨</a></li>
    <li><a href="#26-æ·»åŠ nodeèŠ‚ç‚¹">2.6 æ·»åŠ NodeèŠ‚ç‚¹</a></li>
  </ol>

  <ol>
    <li><a href="#remotewriteä½¿èƒ½">remoteWriteä½¿èƒ½</a></li>
    <li><a href="#41-å®‰è£…prometheus-grafana">4.1 å®‰è£…Prometheus Grafana</a></li>
    <li><a href="#42-å®‰è£…ingress-nginx">4.2 å®‰è£…ingress-nginx</a></li>
    <li><a href="#43-ç”ŸæˆåŸŸåè¯ä¹¦">4.3 ç”ŸæˆåŸŸåè¯ä¹¦</a></li>
    <li><a href="#44-å¯¼å…¥è¯ä¹¦">4.4 å¯¼å…¥è¯ä¹¦</a></li>
    <li><a href="#45-ingressè½¬å‘prometheus-grafana">4.5 ingressè½¬å‘prometheus grafana</a></li>
    <li><a href="#46-ingressè½¬å‘nginxæµ‹è¯•æœåŠ¡">4.6 ingressè½¬å‘nginxæµ‹è¯•æœåŠ¡</a></li>
  </ol>

  <ol>
    <li><a href="#ä¿®æ”¹ä¸ºnodeport">ä¿®æ”¹ä¸ºnodePort</a></li>
    <li><a href="#å¯¼å…¥è¯ä¹¦">å¯¼å…¥è¯ä¹¦</a></li>
    <li><a href="#åˆ›å»ºtoken">åˆ›å»ºtoken</a></li>
    <li><a href="#dashboard-rbacyaml">dashboard-rbac.yaml</a></li>
    <li><a href="#ingress-bashbordyaml">ingress-bashbord.yaml</a></li>
  </ol>

  <ol>
    <li><a href="#nfs-client-provisioneryaml">nfs-client-provisioner.yaml</a></li>
  </ol>

  <ol>
    <li><a href="#å®‰è£…minio--operator">å®‰è£…minio  operator</a></li>
    <li><a href="#æ§åˆ¶ç•Œé¢">æ§åˆ¶ç•Œé¢</a></li>
    <li><a href="#åˆ›å»ºminioé›†ç¾¤">åˆ›å»ºminioé›†ç¾¤</a></li>
    <li><a href="#ç”Ÿæˆ3çº§åŸŸåè¯ä¹¦">ç”Ÿæˆ3çº§åŸŸåè¯ä¹¦</a></li>
    <li><a href="#å¯¼å…¥è¯ä¹¦-1">å¯¼å…¥è¯ä¹¦</a></li>
    <li><a href="#ingress-minioyaml">ingress-minio.yaml</a></li>
    <li><a href="#é…ç½®åŸŸåè§£æ">é…ç½®åŸŸåè§£æ</a></li>
    <li><a href="#413-request-entity-too-large">413 Request Entity Too Large</a>
      <ol>
        <li><a href="#æ–¹æ¡ˆ1-ä¿®æ”¹è‡ªå·±çš„ingress">æ–¹æ¡ˆ1 ä¿®æ”¹è‡ªå·±çš„ingress</a></li>
        <li><a href="#æ–¹æ¡ˆ2-å…¨å±€-ingress-configmap">æ–¹æ¡ˆ2 å…¨å±€ ingress configmap</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#iptables-æ¨¡å¼">iptables æ¨¡å¼</a></li>
        <li><a href="#ipvs-æ¨¡å¼">ipvs æ¨¡å¼</a></li>
        <li><a href="#kube-proxy-ipvså’Œiptablesçš„å¼‚åŒ">kube-proxy ipvså’Œiptablesçš„å¼‚åŒ</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#spine--leaf--rr">spine  Leaf  RR</a></li>
    <li><a href="#å…³äº-cni-é€‰å‹">å…³äº CNI é€‰å‹</a></li>
    <li><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-calico">ä¸ºä»€ä¹ˆé€‰æ‹© Calico</a></li>
    <li><a href="#å…³äº-metallb">å…³äº MetalLB</a></li>
  </ol>

  <ol>
    <li><a href="#installation">INSTALLATION</a>
      <ol>
        <li><a href="#preparation">Preparation</a></li>
        <li><a href="#installation-by-manifest">Installation By Manifest</a></li>
        <li><a href="#installation-with-kustomize">Installation With Kustomize</a></li>
        <li><a href="#installation-with-helm">Installation With Helm</a></li>
        <li><a href="#using-the-metallb-operator">Using The MetalLB Operator</a></li>
        <li><a href="#frr-daemons-logging-level">FRR Daemons Logging Level</a></li>
        <li><a href="#upgrade">Upgrade</a></li>
        <li><a href="#setting-the-loadbalancer-class">Setting The LoadBalancer Class</a></li>
      </ol>
    </li>
    <li><a href="#configuration">CONFIGURATION</a>
      <ol>
        <li><a href="#defining-the-ips-to-assign-to-the-load-balancer-services">Defining The IPs To Assign To The Load Balancer Services</a></li>
        <li><a href="#announce-the-service-ips">Announce The Service IPs</a></li>
        <li><a href="#layer-2-configuration">Layer 2 Configuration</a></li>
        <li><a href="#bgp-configuration">BGP Configuration</a>
          <ol>
            <li><a href="#enabling-bfd-support-for-bgp-sessions">Enabling BFD support for BGP sessions</a></li>
          </ol>
        </li>
        <li><a href="#configuration-validation">Configuration Validation</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#æŸ¥çœ‹æ‰€æœ‰-pod-åˆ—è¡¨---n-åè·Ÿ-namespace-æŸ¥çœ‹æŒ‡å®šçš„å‘½åç©ºé—´"><strong>æŸ¥çœ‹æ‰€æœ‰</strong> <strong>pod</strong> <strong>åˆ—è¡¨,  -n</strong> <strong>åè·Ÿ</strong> <strong>namespace,</strong> <strong>æŸ¥çœ‹æŒ‡å®šçš„å‘½åç©ºé—´</strong></a></li>
    <li><a href="#æŸ¥çœ‹-rc-å’Œ-service-åˆ—è¡¨--o-wide-æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"><strong>æŸ¥çœ‹</strong> <strong>RC</strong> <strong>å’Œ</strong> <strong>service</strong> <strong>åˆ—è¡¨ï¼Œ</strong> <strong>-o wide</strong> <strong>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</strong></a></li>
    <li><a href="#æ˜¾ç¤º-node-çš„è¯¦ç»†ä¿¡æ¯"><strong>æ˜¾ç¤º</strong> <strong>Node</strong> <strong>çš„è¯¦ç»†ä¿¡æ¯</strong></a></li>
    <li><a href="#æ˜¾ç¤º-pod-çš„è¯¦ç»†ä¿¡æ¯-ç‰¹åˆ«æ˜¯æŸ¥çœ‹-pod-æ— æ³•åˆ›å»ºçš„æ—¶å€™çš„æ—¥å¿—"><strong>æ˜¾ç¤º</strong> <strong>Pod</strong> <strong>çš„è¯¦ç»†ä¿¡æ¯,</strong> <strong>ç‰¹åˆ«æ˜¯æŸ¥çœ‹</strong> <strong>pod</strong> <strong>æ— æ³•åˆ›å»ºçš„æ—¶å€™çš„æ—¥å¿—</strong></a></li>
    <li><a href="#æ ¹æ®-yaml-åˆ›å»ºèµ„æº-apply-å¯ä»¥é‡å¤æ‰§è¡Œcreate-ä¸è¡Œ"><strong>æ ¹æ®</strong> <strong>yaml</strong> <strong>åˆ›å»ºèµ„æº, apply</strong> <strong>å¯ä»¥é‡å¤æ‰§è¡Œï¼Œcreate</strong> <strong>ä¸è¡Œ</strong></a></li>
    <li><a href="#åŸºäº-podyaml-å®šä¹‰çš„åç§°åˆ é™¤æŒ‡å®šèµ„æº"><strong>åŸºäº pod.yaml</strong> <strong>å®šä¹‰çš„åç§°åˆ é™¤æŒ‡å®šèµ„æº</strong></a></li>
    <li><a href="#åˆ é™¤æ‰€æœ‰åŒ…å«æŸä¸ª-label-çš„pod-å’Œ-service"><strong>åˆ é™¤æ‰€æœ‰åŒ…å«æŸä¸ª</strong> <strong>label</strong> <strong>çš„pod</strong> <strong>å’Œ</strong> <strong>service</strong></a></li>
    <li><a href="#åˆ é™¤é»˜è®¤å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰-pod"><strong>åˆ é™¤é»˜è®¤å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰</strong> <strong>Pod</strong></a></li>
    <li><a href="#æ‰§è¡Œ-pod-å‘½ä»¤"><strong>æ‰§è¡Œ</strong> <strong>pod</strong> <strong>å‘½ä»¤</strong></a></li>
    <li><a href="#é€šè¿‡bashè·å¾—-pod-ä¸­æŸä¸ªå®¹å™¨httpscloudtencentcomproducttkefrom10680çš„ttyç›¸å½“äºç™»å½•å®¹å™¨"><strong>é€šè¿‡bashè·å¾—</strong> <strong>pod</strong> <strong>ä¸­æŸä¸ª</strong><a href="https://cloud.tencent.com/product/tke?from=10680"><strong>å®¹å™¨</strong></a><strong>çš„TTYï¼Œç›¸å½“äºç™»å½•å®¹å™¨</strong></a></li>
    <li><a href="#æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"><strong>æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</strong></a></li>
    <li><a href="#æŸ¥çœ‹èŠ‚ç‚¹-labels"><strong>æŸ¥çœ‹èŠ‚ç‚¹</strong> <strong>labels</strong></a></li>
    <li><a href="#é‡å¯-pod"><strong>é‡å¯</strong> <strong>pod</strong></a></li>
    <li><a href="#åˆ›å»ºå‘½ä»¤"><strong>åˆ›å»ºå‘½ä»¤</strong></a></li>
    <li><a href="#æŸ¥çœ‹å’ŒæŸ¥æ‰¾èµ„æº"><strong>æŸ¥çœ‹å’ŒæŸ¥æ‰¾èµ„æº</strong></a></li>
    <li><a href="#æ›´æ–°èµ„æº"><strong>æ›´æ–°èµ„æº</strong></a></li>
    <li><a href="#éƒ¨åˆ†æ›´æ–°èµ„æº"><strong>éƒ¨åˆ†æ›´æ–°èµ„æº</strong></a></li>
    <li><a href="#åˆ é™¤èµ„æº"><strong>åˆ é™¤èµ„æº</strong></a></li>
    <li><a href="#podå¸¸ç”¨æ“ä½œ"><strong>Podå¸¸ç”¨æ“ä½œ</strong></a></li>
    <li><a href="#èŠ‚ç‚¹æ“ä½œ"><strong>èŠ‚ç‚¹æ“ä½œ</strong></a></li>
  </ol>

  <ol>
    <li>
      <ol>
        <li><a href="#ingress-nginx-serviceyaml">ingress-nginx-service.yaml</a></li>
        <li><a href="#ingress-grafana-prometheus-serviceyaml">ingress-grafana-prometheus-service.yaml</a></li>
        <li><a href="#nginx-deploymentyaml">nginx-deployment.yaml</a></li>
        <li><a href="#nginx-serviceyaml">nginx-service.yaml</a></li>
        <li><a href="#nginx-minioyaml">nginx-minio.yaml</a></li>
        <li><a href="#redis---rbacyaml">redis - rbac.yaml</a></li>
        <li><a href="#ingress-nginx-deploy-daemonsetyaml">ingress-nginx-deploy-daemonset.yaml</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/k8s-install/">Kubernetes</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            install k8s
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 09, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    54 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>Kubernetes</p>
<p>ä»¥ä¸‹æ˜¯Kubernetesçš„ä¸»è¦çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥ä½œä¸ºå­¦ä¹ å’Œä½¿ç”¨Kubernetesçš„å‚è€ƒï¼š</p>
<ol>
<li>å®¹å™¨æŠ€æœ¯åŸºç¡€ï¼šDockerï¼ŒPod</li>
<li>Kubernetesçš„åŸºæœ¬æ¦‚å¿µï¼šNodeï¼ŒPodï¼ŒDeploymentï¼ŒServiceï¼ŒConfigMapï¼ŒSecretï¼ŒIngressï¼ŒNamespaceï¼ŒLabel</li>
<li>Kubernetesçš„æ ¸å¿ƒç»„ä»¶ï¼šAPI Serverï¼Œetcdï¼Œkube-schedulerï¼Œkube-controller-managerï¼Œkubeletï¼Œkube-proxy</li>
<li>Kubernetesçš„å¯¹è±¡æ¨¡å‹ï¼šKubernetes API å¯¹è±¡ï¼ŒKubernetes API çš„ç‰ˆæœ¬</li>
<li>Kubernetesçš„éƒ¨ç½²æ–¹å¼ï¼šå•èŠ‚ç‚¹ï¼Œå¤šèŠ‚ç‚¹ï¼Œäº‘å¹³å°</li>
<li>Kubernetesçš„èµ„æºç®¡ç†ï¼šCPUï¼Œå†…å­˜ï¼Œå­˜å‚¨ï¼Œç½‘ç»œ</li>
<li>Kubernetesçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šServiceï¼ŒEndpointï¼ŒIngressï¼ŒLoadBalancer</li>
<li>Kubernetesçš„å­˜å‚¨ç®¡ç†ï¼šPersistentVolumeï¼ŒPersistentVolumeClaimï¼ŒStorageClass</li>
<li>Kubernetesçš„ç½‘ç»œç®¡ç†ï¼šCNIï¼Œç½‘ç»œç­–ç•¥</li>
<li>Kubernetesçš„è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨ä¼¸ç¼©ï¼Œè‡ªåŠ¨æ‰©å®¹ï¼Œè‡ªåŠ¨å‡çº§</li>
<li>Kubernetesçš„æ‰©å±•ï¼šCRDï¼ŒOperator</li>
<li>Kubernetesçš„å®‰å…¨ï¼šTLSï¼ŒRBACï¼ŒPod Security Policyï¼ŒSecrets Encryption</li>
<li>Kubernetesçš„è°ƒè¯•å’Œæ•…éšœæ’é™¤ï¼škubectl å‘½ä»¤ï¼Œäº‹ä»¶ï¼Œæ—¥å¿—ï¼Œdebug container</li>
<li>Kubernetesçš„ç›‘æ§ï¼šHeapsterï¼ŒPrometheusï¼ŒGrafana</li>
<li>Kubernetesçš„CI/CDï¼šJenkinsï¼ŒGitLabï¼ŒSpinnaker</li>
</ol>
<p>ä»¥ä¸Šæ˜¯Kubernetesçš„ä¸»è¦çŸ¥è¯†ç‚¹ï¼ŒKubernetesæ˜¯ä¸€ä¸ªåºå¤§è€Œå¤æ‚çš„ç³»ç»Ÿï¼Œéœ€è¦ä¸æ–­çš„å­¦ä¹ å’Œå®è·µæ‰èƒ½æŒæ¡ã€‚å»ºè®®æŒ‰ç…§å­¦ä¹ æ­¥éª¤é€ä¸€æ·±å…¥å­¦ä¹ ã€‚</p>
<h1 id="1-å‡†å¤‡">1. å‡†å¤‡</h1>
<p><a class="link" href="https://www.cnblogs.com/bamboo-green/p/17128474.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/bamboo-green/p/17128474.html</a></p>
<h2 id="service-monitor-æ— æ³•å‘ç°">service monitor æ— æ³•å‘ç°</h2>
<p><a class="link" href="https://www.kococ.cn/20211124/cid=721.html"  target="_blank" rel="noopener"
    >https://www.kococ.cn/20211124/cid=721.html</a></p>
<p><a class="link" href="https://www.lvbibir.cn/posts/tech/kubernetes-prometheus-3-servicemonitor-podmonitor/"  target="_blank" rel="noopener"
    >https://www.lvbibir.cn/posts/tech/kubernetes-prometheus-3-servicemonitor-podmonitor/</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"></code></pre></td></tr></table>
</div>
</div><h2 id="11-ç³»ç»Ÿé…ç½®">1.1 ç³»ç»Ÿé…ç½®</h2>
<ul>
<li>
<h3 id="ä¿®æ”¹hosts">ä¿®æ”¹hosts</h3>
</li>
</ul>
<p>åœ¨å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å…ˆåšå¥½å¦‚ä¸‹å‡†å¤‡ã€‚3å°CentOS 7.9ä¸»æœºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># cat /etc/hosts</span>
</span></span><span class="line"><span class="cl">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span class="line"><span class="cl">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span class="line"><span class="cl">192.168.10.20 master
</span></span><span class="line"><span class="cl">192.168.10.21 node01
</span></span><span class="line"><span class="cl">192.168.10.22 node02
</span></span><span class="line"><span class="cl">192.168.10.23 node03
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å„ä¸ªä¸»æœºä¸Šå®Œæˆä¸‹é¢çš„ç³»ç»Ÿé…ç½®ã€‚</p>
<ul>
<li>
<h3 id="å…³é—­é˜²ç«å¢™">å…³é—­é˜²ç«å¢™</h3>
</li>
</ul>
<p>å¦‚æœå„ä¸ªä¸»æœºå¯ç”¨äº†é˜²ç«å¢™ç­–ç•¥ï¼Œéœ€è¦å¼€æ”¾Kuberneteså„ä¸ªç»„ä»¶æ‰€éœ€è¦çš„ç«¯å£ï¼Œå¯ä»¥æŸ¥çœ‹<a class="link" href="https://kubernetes.io/docs/reference/ports-and-protocols/"  target="_blank" rel="noopener"
    >Ports and Protocols</a>ä¸­çš„å†…å®¹, å¼€æ”¾ç›¸å…³ç«¯å£æˆ–è€…å…³é—­ä¸»æœºçš„é˜²ç«å¢™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl disable firewalld --now
</span></span><span class="line"><span class="cl">iptables -F <span class="o">&amp;&amp;</span> iptables -t nat -F <span class="o">&amp;&amp;</span> iptables -t mangle -F <span class="o">&amp;&amp;</span> iptables -X
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<h3 id="å…³é—­-selinux">å…³é—­ selinux</h3>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">setenforce <span class="m">0</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span>  /etc/selinux/config
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<h3 id="å¿…é¡»å®‰è£…iptables">å¿…é¡»å®‰è£…iptables</h3>
</li>
<li>
<h3 id="åˆ›å»ºetcmodules-loaddcontainerdconfé…ç½®æ–‡ä»¶">åˆ›å»º/etc/modules-load.d/containerd.confé…ç½®æ–‡ä»¶:</h3>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt; EOF &gt; /etc/modules-load.d/containerd.conf
</span></span></span><span class="line"><span class="cl"><span class="s">overlay
</span></span></span><span class="line"><span class="cl"><span class="s">br_netfilter
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">modprobe overlay
</span></span><span class="line"><span class="cl">modprobe br_netfilter
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»º/etc/sysctl.d/99-kubernetes-cri.confé…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt; EOF &gt; /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.ipv4.ip_forward = 1
</span></span></span><span class="line"><span class="cl"><span class="s">user.max_user_namespaces=28633
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="12-åŠ è½½å†…æ ¸modules-ipvs">1.2 åŠ è½½å†…æ ¸modules ipvs</h2>
<p>å¯ä»¥å‚è€ƒhttps://github.com/kubernetes/kubernetes/blob/master/pkg/proxy/ipvs/README.md</p>
<p>ç”±äºipvså·²ç»åŠ å…¥åˆ°äº†å†…æ ¸çš„ä¸»å¹²ï¼Œæ‰€ä»¥ä¸ºkube-proxyå¼€å¯ipvsçš„å‰æéœ€è¦åŠ è½½ä»¥ä¸‹çš„å†…æ ¸æ¨¡å—ï¼š</p>
<p>å†…æ ¸æ¨¡å—ä½ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/lib/modules/5.4.209-1.el7.elrepo.x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹è„šæœ¬:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum install ipvsadm ipset sysstat conntrack libseccomp -y
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®ipvsæ¨¡å—ï¼Œåœ¨å†…æ ¸4.19+ç‰ˆæœ¬nf_conntrack_ipv4å·²ç»æ”¹ä¸ºnf_conntrack</span>
</span></span><span class="line"><span class="cl">cat &gt; /etc/modules-load.d/ipvs.conf <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_lc
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_wlc
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_rr
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_wrr
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_lblc
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_lblcr
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_dh
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_sh
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_fo
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_nq
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_sed
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_ftp
</span></span></span><span class="line"><span class="cl"><span class="s">ip_vs_sh
</span></span></span><span class="line"><span class="cl"><span class="s">nf_conntrack
</span></span></span><span class="line"><span class="cl"><span class="s">ip_tables
</span></span></span><span class="line"><span class="cl"><span class="s">ip_set
</span></span></span><span class="line"><span class="cl"><span class="s">xt_set
</span></span></span><span class="line"><span class="cl"><span class="s">ipt_set
</span></span></span><span class="line"><span class="cl"><span class="s">ipt_rpfilter
</span></span></span><span class="line"><span class="cl"><span class="s">ipt_REJECT
</span></span></span><span class="line"><span class="cl"><span class="s">ipip
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> --now systemd-modules-load.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>lsmod | grep -e ip_vs -e nf_conntrack</code>å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜éœ€è¦ç¡®ä¿å„ä¸ªèŠ‚ç‚¹ä¸Šå·²ç»å®‰è£…äº†ipsetè½¯ä»¶åŒ…ï¼Œä¸ºäº†ä¾¿äºæŸ¥çœ‹ipvsçš„ä»£ç†è§„åˆ™ï¼Œæœ€å¥½å®‰è£…ä¸€ä¸‹ç®¡ç†å·¥å…·ipvsadmã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum install -y ipset ipvsadm
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šå‰ææ¡ä»¶ï¼Œåˆ™å³ä½¿kube-proxyçš„é…ç½®å¼€å¯äº†ipvsæ¨¡å¼ï¼Œä¹Ÿä¼šé€€å›åˆ°iptablesæ¨¡å¼ã€‚</p>
<h2 id="13-docker">1.3 docker</h2>
<h3 id="å®‰è£…docker">å®‰è£…Docker</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
</span></span><span class="line"><span class="cl">yum -y install docker-ce
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> docker <span class="o">&amp;&amp;</span> systemctl start docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®é•œåƒä¸‹è½½åŠ é€Ÿå™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">cat</span> <span class="o">&gt;</span> <span class="err">/etc/docker/daemon.json &lt;&lt; EOF</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;registry-mirrors&#34;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;https://292nm6nu.mirror.aliyuncs.com&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;exec-opts&#34;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;native.cgroupdriver=systemd&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">EOF</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">restart</span> <span class="nx">docker</span>
</span></span><span class="line"><span class="cl"><span class="nx">docker</span> <span class="nx">info</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…cri-dockerd">å®‰è£…cri-dockerd</h3>
<p>Kubernetes v1.24ç§»é™¤docker-shimçš„æ”¯æŒï¼Œè€ŒDocker Engineé»˜è®¤åˆä¸æ”¯æŒCRIæ ‡å‡†ï¼Œå› æ­¤äºŒè€…é»˜è®¤æ— æ³•å†ç›´æ¥é›†æˆã€‚ä¸ºæ­¤ï¼ŒMirantiså’ŒDockerè”åˆåˆ›å»ºäº†cri-dockerdé¡¹ç›®ï¼Œç”¨äºä¸ºDocker Engineæä¾›ä¸€ä¸ªèƒ½å¤Ÿæ”¯æŒåˆ°CRIè§„èŒƒçš„æ¡¥æ¢ï¼Œä»è€Œèƒ½å¤Ÿè®©Dockerä½œä¸ºKuberneteså®¹å™¨å¼•æ“ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p>[https://img2023.cnblogs.com/blog/1772495/202302/1772495-20230216220036444-1454369319.png]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.1/cri-dockerd-0.3.1-3.el7.x86_64.rpm
</span></span><span class="line"><span class="cl">rpm -ivh cri-dockerd-0.3.1-3.el7.x86_64.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‡å®šä¾èµ–é•œåƒåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">vim</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">systemd</span><span class="o">/</span><span class="nx">system</span><span class="o">/</span><span class="nx">cri</span><span class="o">-</span><span class="nx">docker</span><span class="p">.</span><span class="nx">service</span>
</span></span><span class="line"><span class="cl"><span class="nx">æŠŠåŸæ¥çš„æ³¨é‡Šä¸€ä¸‹æ·»åŠ å¦‚ä¸‹</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="nx">ExecStart</span><span class="o">=</span><span class="err">/usr/bin/cri-dockerd --container-runtime-endpoint fd://</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ExecStart</span><span class="o">=</span><span class="err">/usr/bin/cri-dockerd --container-runtime-endpoint fd:// --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">daemon</span><span class="o">-</span><span class="nx">reload</span> 
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">enable</span> <span class="nx">cri</span><span class="o">-</span><span class="nx">docker</span> <span class="o">&amp;&amp;</span> <span class="nx">systemctl</span> <span class="nx">start</span> <span class="nx">cri</span><span class="o">-</span><span class="nx">docker</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ·»åŠ é˜¿é‡Œäº‘yumè½¯ä»¶æº">æ·»åŠ é˜¿é‡Œäº‘YUMè½¯ä»¶æº</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">cat</span> <span class="err">&gt;</span> <span class="err">/etc/yum.repos.d/kubernetes.repo</span> <span class="err">&lt;&lt;</span> <span class="err">EOF</span>
</span></span><span class="line"><span class="cl"><span class="err">[kubernetes]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>Kubernetes
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">repo_gpgcheck</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span><span class="line"><span class="cl"><span class="err">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…kubeadmkubeletå’Œkubectl">å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</h3>
<p>ç”±äºç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œè¿™é‡ŒæŒ‡å®šç‰ˆæœ¬å·éƒ¨ç½²ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install -y kubelet kubeadm kubectl
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> kubelet
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="14--containerdrunc">1.4  Containerdã€runc</h2>
<p><strong>1ã€é…ç½®å…ˆå†³æ¡ä»¶</strong></p>
<p>å¦‚æœæ˜¯ç”±dockeråˆ‡containerdè¿™æ­¥å¯çœç•¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
</span></span></span><span class="line"><span class="cl"><span class="s">overlay
</span></span></span><span class="line"><span class="cl"><span class="s">br_netfilter
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo modprobe overlay
</span></span><span class="line"><span class="cl">sudo modprobe br_netfilter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-iptables  = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.ipv4.ip_forward                 = 1
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo sysctl --system
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2ã€å®‰è£…containerd</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">yum</span><span class="o">-</span><span class="n">utils</span> <span class="n">device</span><span class="o">-</span><span class="n">mapper</span><span class="o">-</span><span class="n">persistent</span><span class="o">-</span><span class="n">data</span> <span class="n">lvm2</span>
</span></span><span class="line"><span class="cl"><span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="err">\</span>
</span></span><span class="line"><span class="cl">    <span class="c1">--add-repo \</span>
</span></span><span class="line"><span class="cl">    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download.docker</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce.repo</span>
</span></span><span class="line"><span class="cl"><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">containerd.io</span>
</span></span><span class="line"><span class="cl"><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">containerd</span>
</span></span><span class="line"><span class="cl"><span class="n">containerd</span> <span class="n">config</span> <span class="n">default</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">containerd</span><span class="o">/</span><span class="n">config.toml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p>
<ul>
<li>pauseé•œåƒè®¾ç½®è¿‡é˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</li>
<li>æ‹‰å–Docker Hubé•œåƒé…ç½®åŠ é€Ÿåœ°å€è®¾ç½®ä¸ºé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">vi</span> <span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">containerd</span><span class="p">/</span><span class="n">config</span><span class="p">.</span><span class="n">toml</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="na">   [plugins.&#34;io.containerd.grpc.v1.cri&#34;]</span>
</span></span><span class="line"><span class="cl">      <span class="n">sandbox_image</span> <span class="p">=</span> <span class="s">&#34;registry.aliyuncs.com/google_containers/pause:3.2&#34;</span>  
</span></span><span class="line"><span class="cl">       <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="na">   [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors]</span>
</span></span><span class="line"><span class="cl"><span class="na">          [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;docker.io&#34;]</span>
</span></span><span class="line"><span class="cl">            <span class="n">endpoint</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;https://b9pmyelo.mirror.aliyuncs.com&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl"><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">containerd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>4ã€é…ç½®kubeletä½¿ç”¨containerd</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vi /var/lib/kubelet/kubeadm-flags.env
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_KUBEADM_ARGS</span><span class="o">=</span><span class="s2">&#34;--container-runtime=remote --container-runtime-endpoint=unix:///run/containerd/containerd.sock --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.8&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl restart kubelet
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>5ã€éªŒè¯</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="k">get</span> <span class="n">node</span> <span class="p">-</span><span class="n">o</span> <span class="n">wide</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k8s</span><span class="p">-</span><span class="n">node1</span>  <span class="n">xxx</span>  <span class="n">containerd</span><span class="p">:</span><span class="c1">//1.5.6</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://img2023.cnblogs.com/blog/1772495/202302/1772495-20230216221027779-324412180.png"
	
	
	
	loading="lazy"
	
		alt="get node"
	
	
></p>
<p><strong>6ã€ç®¡ç†å®¹å™¨å·¥å…·</strong></p>
<p>containerdæä¾›äº†ctrå‘½ä»¤è¡Œå·¥å…·ç®¡ç†å®¹å™¨ï¼Œä½†åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šç”¨crictlå·¥å…·æ£€æŸ¥å’Œè°ƒè¯•å®¹å™¨ã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼šhttps://github.com/kubernetes-sigs/cri-tools/</p>
<p>è®¾ç½®crictlè¿æ¥containerdï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vi /etc/crictl.yaml
</span></span><span class="line"><span class="cl">runtime-endpoint: unix:///run/containerd/containerd.sock
</span></span><span class="line"><span class="cl">image-endpoint: unix:///run/containerd/containerd.sock
</span></span><span class="line"><span class="cl">timeout: <span class="m">10</span>
</span></span><span class="line"><span class="cl">debug: <span class="nb">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šå®‰è£…å®¹å™¨è¿è¡Œæ—¶Containerdã€‚</p>
<p>å¯ä»¥é€‰æ‹©yumå®‰è£…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum install -y containerd.io runc
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹è½½Containerdçš„äºŒè¿›åˆ¶åŒ…:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://github.com/containerd/containerd/releases/download/v1.6.6/cri-containerd-cni-1.6.6-linux-amd64.tar.gz
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>cri-containerd-cni-1.6.4-linux-amd64.tar.gz</code>å‹ç¼©åŒ…ä¸­å·²ç»æŒ‰ç…§å®˜æ–¹äºŒè¿›åˆ¶éƒ¨ç½²æ¨èçš„ç›®å½•ç»“æ„å¸ƒå±€å¥½ã€‚ é‡Œé¢åŒ…å«äº†systemdé…ç½®æ–‡ä»¶ï¼Œcontainerdä»¥åŠcniçš„éƒ¨ç½²æ–‡ä»¶ã€‚ å°†è§£å‹ç¼©åˆ°ç³»ç»Ÿçš„æ ¹ç›®å½•<code>/</code>ä¸­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">tar -zxvf cri-containerd-cni-1.6.4-linux-amd64.tar.gz -C /
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">etc/
</span></span><span class="line"><span class="cl">etc/systemd/
</span></span><span class="line"><span class="cl">etc/systemd/system/
</span></span><span class="line"><span class="cl">etc/systemd/system/containerd.service
</span></span><span class="line"><span class="cl">etc/crictl.yaml
</span></span><span class="line"><span class="cl">etc/cni/
</span></span><span class="line"><span class="cl">etc/cni/net.d/
</span></span><span class="line"><span class="cl">etc/cni/net.d/10-containerd-net.conflist
</span></span><span class="line"><span class="cl">usr/
</span></span><span class="line"><span class="cl">usr/local/
</span></span><span class="line"><span class="cl">usr/local/sbin/
</span></span><span class="line"><span class="cl">usr/local/sbin/runc
</span></span><span class="line"><span class="cl">usr/local/bin/
</span></span><span class="line"><span class="cl">usr/local/bin/critest
</span></span><span class="line"><span class="cl">usr/local/bin/containerd-shim
</span></span><span class="line"><span class="cl">usr/local/bin/containerd-shim-runc-v1
</span></span><span class="line"><span class="cl">usr/local/bin/ctd-decoder
</span></span><span class="line"><span class="cl">usr/local/bin/containerd
</span></span><span class="line"><span class="cl">usr/local/bin/containerd-shim-runc-v2
</span></span><span class="line"><span class="cl">usr/local/bin/containerd-stress
</span></span><span class="line"><span class="cl">usr/local/bin/ctr
</span></span><span class="line"><span class="cl">usr/local/bin/crictl
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">opt/cni/
</span></span><span class="line"><span class="cl">opt/cni/bin/
</span></span><span class="line"><span class="cl">opt/cni/bin/bridge
</span></span><span class="line"><span class="cl">......
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ç»æµ‹è¯•cri-containerd-cni-1.6.4-linux-amd64.tar.gzåŒ…ä¸­åŒ…å«çš„runcåœ¨CentOS 7ä¸‹çš„åŠ¨æ€é“¾æ¥æœ‰é—®é¢˜ï¼Œè¿™é‡Œä»runcçš„githubä¸Šå•ç‹¬ä¸‹è½½runcï¼Œå¹¶æ›¿æ¢ä¸Šé¢å®‰è£…çš„containerdä¸­çš„runc:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://github.com/opencontainers/runc/releases/download/v1.1.2/runc.amd64
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ç”Ÿæˆcontainerdçš„é…ç½®æ–‡ä»¶:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /etc/containerd
</span></span><span class="line"><span class="cl">containerd config default &gt; /etc/containerd/config.toml
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®æ–‡æ¡£<a class="link" href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/"  target="_blank" rel="noopener"
    >Container runtimes </a>ä¸­çš„å†…å®¹ï¼Œå¯¹äºä½¿ç”¨systemdä½œä¸ºinit systemçš„Linuxçš„å‘è¡Œç‰ˆï¼Œä½¿ç”¨systemdä½œä¸ºå®¹å™¨çš„cgroup driverå¯ä»¥ç¡®ä¿æœåŠ¡å™¨èŠ‚ç‚¹åœ¨èµ„æºç´§å¼ çš„æƒ…å†µæ›´åŠ ç¨³å®šï¼Œå› æ­¤è¿™é‡Œé…ç½®å„ä¸ªèŠ‚ç‚¹ä¸Šcontainerdçš„cgroup driverä¸ºsystemdã€‚</p>
<p>ä¿®æ”¹å‰é¢ç”Ÿæˆçš„é…ç½®æ–‡ä»¶<code>/etc/containerd/config.toml</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">.</span><span class="nx">options</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SystemdCgroup</span> <span class="p">=</span> <span class="kc">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†ä¿®æ”¹<code>/etc/containerd/config.toml</code>ä¸­çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.grpc.v1.cri&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="c"># sandbox_image = &#34;k8s.gcr.io/pause:3.6&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sandbox_image</span> <span class="p">=</span> <span class="s2">&#34;registry.aliyuncs.com/google_containers/pause:3.7&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®containerdå¼€æœºå¯åŠ¨ï¼Œå¹¶å¯åŠ¨containerd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl disable containerd --now
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨crictlæµ‹è¯•ä¸€ä¸‹ï¼Œç¡®ä¿å¯ä»¥æ‰“å°å‡ºç‰ˆæœ¬ä¿¡æ¯å¹¶ä¸”æ²¡æœ‰é”™è¯¯ä¿¡æ¯è¾“å‡º:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">crictl version
</span></span><span class="line"><span class="cl">Version:  0.1.0
</span></span><span class="line"><span class="cl">RuntimeName:  containerd
</span></span><span class="line"><span class="cl">RuntimeVersion:  v1.6.4
</span></span><span class="line"><span class="cl">RuntimeApiVersion:  v1alpha2
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="2-ä½¿ç”¨kubeadméƒ¨ç½²kubernetes">2. ä½¿ç”¨kubeadméƒ¨ç½²Kubernetes</h1>
<h2 id="21-å®‰è£…kubeadmå’Œkubelet">2.1 å®‰è£…kubeadmå’Œkubelet</h2>
<p>ä¸‹é¢åœ¨å„èŠ‚ç‚¹å®‰è£…kubeadmå’Œkubeletï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span class="line"><span class="cl"><span class="s">[kubernetes]
</span></span></span><span class="line"><span class="cl"><span class="s">name=Kubernetes
</span></span></span><span class="line"><span class="cl"><span class="s">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span class="line"><span class="cl"><span class="s">enabled=1
</span></span></span><span class="line"><span class="cl"><span class="s">gpgcheck=1
</span></span></span><span class="line"><span class="cl"><span class="s">repo_gpgcheck=0
</span></span></span><span class="line"><span class="cl"><span class="s">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
</span></span></span><span class="line"><span class="cl"><span class="s">        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum makecache fast
</span></span><span class="line"><span class="cl">yum install kubelet kubeadm kubectl
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œ<code>kubelet --help</code>å¯ä»¥çœ‹åˆ°åŸæ¥kubeletçš„ç»å¤§å¤šæ•°å‘½ä»¤è¡Œflagå‚æ•°éƒ½è¢«<code>DEPRECATED</code>äº†ï¼Œå®˜æ–¹æ¨èæˆ‘ä»¬ä½¿ç”¨<code>--config</code>æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šåŸæ¥è¿™äº›flagæ‰€é…ç½®çš„å†…å®¹ã€‚å…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹è¿™é‡Œ<a class="link" href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/"  target="_blank" rel="noopener"
    >Set Kubelet parameters via a config file</a>ã€‚<strong>æœ€åˆKubernetesè¿™ä¹ˆåšæ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€Kubeleté…ç½®ï¼ˆDynamic Kubelet Configurationï¼‰ï¼Œä½†åŠ¨æ€Kubeleté…ç½®ç‰¹æ€§ä»k8s 1.22ä¸­å·²å¼ƒç”¨ï¼Œå¹¶åœ¨1.24ä¸­è¢«ç§»é™¤ã€‚å¦‚æœéœ€è¦è°ƒæ•´é›†ç¾¤æ±‡æ€»æ‰€æœ‰èŠ‚ç‚¹kubeletçš„é…ç½®ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ansibleç­‰å·¥å…·å°†é…ç½®åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹</strong>ã€‚</p>
<p>kubeletçš„é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯jsonæˆ–yamlæ ¼å¼ï¼Œå…·ä½“å¯æŸ¥çœ‹<a class="link" href="https://github.com/kubernetes/kubelet/blob/release-1.24/config/v1beta1/types.go"  target="_blank" rel="noopener"
    >è¿™é‡Œ</a>ã€‚</p>
<p>Kubernetes 1.8å¼€å§‹è¦æ±‚å…³é—­ç³»ç»Ÿçš„Swapï¼Œå¦‚æœä¸å…³é—­ï¼Œé»˜è®¤é…ç½®ä¸‹kubeletå°†æ— æ³•å¯åŠ¨ã€‚ å…³é—­ç³»ç»Ÿçš„Swapæ–¹æ³•å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">swapoff -a
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ /etc/fstab æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰ SWAP çš„è‡ªåŠ¨æŒ‚è½½ï¼Œä½¿ç”¨<code>free -m</code>ç¡®è®¤swapå·²ç»å…³é—­ã€‚</p>
<p>swappinesså‚æ•°è°ƒæ•´ï¼Œä¿®æ”¹/etc/sysctl.d/99-kubernetes-cri.confæ·»åŠ ä¸‹é¢ä¸€è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;vm.swappiness=0&#34;</span> &gt;&gt; /etc/sysctl.d/99-kubernetes-cri.conf
</span></span><span class="line"><span class="cl">sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="22-kubeadm-initåˆå§‹åŒ–">2.2 kubeadm initåˆå§‹åŒ–</h2>
<p>åœ¨å„èŠ‚ç‚¹å¼€æœºå¯åŠ¨kubeletæœåŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> kubelet.service --now
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> containerd.service --now
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm config print init-defaults --component-configs KubeletConfiguration
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥æ‰“å°é›†ç¾¤åˆå§‹åŒ–é»˜è®¤çš„ä½¿ç”¨çš„é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">bootstrapTokens</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">system:bootstrappers:kubeadm:default-node-token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l">abcdef.0123456789abcdef</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ttl</span><span class="p">:</span><span class="w"> </span><span class="l">24h0m0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">usages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">signing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">authentication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">InitConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">localAPIEndpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">advertiseAddress</span><span class="p">:</span><span class="w"> </span><span class="m">1.2.3.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">bindPort</span><span class="p">:</span><span class="w"> </span><span class="m">6443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodeRegistration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">criSocket</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///var/run/containerd/containerd.sock</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">taints</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiServer</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">timeoutForControlPlane</span><span class="p">:</span><span class="w"> </span><span class="l">4m0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">certificatesDir</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/pki</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">controllerManager</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">etcd</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">local</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">dataDir</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/etcd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">imageRepository</span><span class="p">:</span><span class="w"> </span><span class="l">k8s.gcr.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kubernetesVersion</span><span class="p">:</span><span class="w"> </span><span class="m">1.24.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networking</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">dnsDomain</span><span class="p">:</span><span class="w"> </span><span class="l">cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">serviceSubnet</span><span class="p">:</span><span class="w"> </span><span class="m">10.96.0.0</span><span class="l">/12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">scheduler</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet.config.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">anonymous</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">webhook</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cacheTTL</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">x509</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">clientCAFile</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/pki/ca.crt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">authorization</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">Webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">webhook</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cacheAuthorizedTTL</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cacheUnauthorizedTTL</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cgroupDriver</span><span class="p">:</span><span class="w"> </span><span class="l">systemd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusterDNS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="m">10.96.0.10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusterDomain</span><span class="p">:</span><span class="w"> </span><span class="l">cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cpuManagerReconcilePeriod</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">evictionPressureTransitionPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">fileCheckFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">healthzBindAddress</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">healthzPort</span><span class="p">:</span><span class="w"> </span><span class="m">10248</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">httpCheckFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">imageMinimumGCAge</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeletConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">flushFrequency</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">json</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">infoBufferSize</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">verbosity</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">memorySwap</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodeStatusReportFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodeStatusUpdateFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rotateCertificates</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">runtimeRequestTimeout</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">shutdownGracePeriod</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">shutdownGracePeriodCriticalPods</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">staticPodPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/manifests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">streamingConnectionIdleTimeout</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">syncFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumeStatsAggPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»é»˜è®¤çš„é…ç½®ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨<code>imageRepository</code>å®šåˆ¶åœ¨é›†ç¾¤åˆå§‹åŒ–æ—¶æ‹‰å–k8sæ‰€éœ€é•œåƒçš„åœ°å€ã€‚åŸºäºé»˜è®¤é…ç½®å®šåˆ¶å‡ºæœ¬æ¬¡ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤æ‰€éœ€çš„é…ç½®æ–‡ä»¶kubeadm.yamlï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">InitConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">localAPIEndpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">advertiseAddress</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.96.151</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">bindPort</span><span class="p">:</span><span class="w"> </span><span class="m">6443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodeRegistration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">criSocket</span><span class="p">:</span><span class="w"> </span><span class="l">unix:///run/containerd/containerd.sock</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">taints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l">PreferNoSchedule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">node-role.kubernetes.io/master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kubernetesVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1.24.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">imageRepository</span><span class="p">:</span><span class="w"> </span><span class="l">registry.aliyuncs.com/google_containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networking</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">podSubnet</span><span class="p">:</span><span class="w"> </span><span class="m">10.244.0.0</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet.config.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeletConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cgroupDriver</span><span class="p">:</span><span class="w"> </span><span class="l">systemd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">failSwapOn</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeproxy.config.k8s.io/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeProxyConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">ipvs</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå®šåˆ¶äº†<code>imageRepository</code>ä¸ºé˜¿é‡Œäº‘çš„registryï¼Œé¿å…å› gcrè¢«å¢™ï¼Œæ— æ³•ç›´æ¥æ‹‰å–é•œåƒã€‚<code>criSocket</code>è®¾ç½®äº†å®¹å™¨è¿è¡Œæ—¶ä¸ºcontainerdã€‚ åŒæ—¶è®¾ç½®kubeletçš„<code>cgroupDriver</code>ä¸ºsystemdï¼Œè®¾ç½®kube-proxyä»£ç†æ¨¡å¼ä¸ºipvsã€‚</p>
<p>åœ¨å¼€å§‹åˆå§‹åŒ–é›†ç¾¤ä¹‹å‰å¯ä»¥ä½¿ç”¨<code>kubeadm config images pull --config kubeadm.yaml</code>é¢„å…ˆåœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šæ‹‰å–æ‰€k8séœ€è¦çš„å®¹å™¨é•œåƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm config images pull --config kubeadm.yaml
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.24.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.24.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.24.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.24.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/pause:3.7
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/etcd:3.5.3-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>config/images<span class="o">]</span> Pulled registry.aliyuncs.com/google_containers/coredns:v1.8.6
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤ï¼Œé€‰æ‹©node1ä½œä¸ºMaster Nodeï¼Œåœ¨node1ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  kubeadm init <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --apiserver-advertise-address<span class="o">=</span>192.168.10.20 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --image-repository registry.aliyuncs.com/google_containers <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --kubernetes-version v1.26.3 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --service-cidr<span class="o">=</span>10.96.0.0/12 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="c1"># --cri-socket=unix:///var/run/cri-dockerd.sock \</span>
</span></span><span class="line"><span class="cl">  --pod-network-cidr<span class="o">=</span>10.244.0.0/16 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --ignore-preflight-errors<span class="o">=</span>all
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm init --config kubeadm.yaml
</span></span><span class="line"><span class="cl">W0526 10:22:26.657615   <span class="m">24076</span> common.go:83<span class="o">]</span> your configuration file uses a deprecated API spec: <span class="s2">&#34;kubeadm.k8s.io/v1beta2&#34;</span>. Please use <span class="s1">&#39;kubeadm config migrate --old-config old.yaml --new-config new.yaml&#39;</span>, which will write the new, similar spec using a newer API version.
</span></span><span class="line"><span class="cl">W0526 10:22:26.660300   <span class="m">24076</span> initconfiguration.go:120<span class="o">]</span> Usage of CRI endpoints without URL scheme is deprecated and can cause kubelet errors in the future. Automatically prepending scheme <span class="s2">&#34;unix&#34;</span> to the <span class="s2">&#34;criSocket&#34;</span> with value <span class="s2">&#34;/run/containerd/containerd.sock&#34;</span>. Please update your configuration!
</span></span><span class="line"><span class="cl"><span class="o">[</span>init<span class="o">]</span> Using Kubernetes version: v1.24.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>preflight<span class="o">]</span> Running pre-flight checks
</span></span><span class="line"><span class="cl">	<span class="o">[</span>WARNING Swap<span class="o">]</span>: swap is enabled<span class="p">;</span> production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet
</span></span><span class="line"><span class="cl"><span class="o">[</span>preflight<span class="o">]</span> Pulling images required <span class="k">for</span> setting up a Kubernetes cluster
</span></span><span class="line"><span class="cl"><span class="o">[</span>preflight<span class="o">]</span> This might take a minute or two, depending on the speed of your internet connection
</span></span><span class="line"><span class="cl"><span class="o">[</span>preflight<span class="o">]</span> You can also perform this action in beforehand using <span class="s1">&#39;kubeadm config images pull&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Using certificateDir folder <span class="s2">&#34;/etc/kubernetes/pki&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;ca&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;apiserver&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> apiserver serving cert is signed <span class="k">for</span> DNS names <span class="o">[</span>kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local node1<span class="o">]</span> and IPs <span class="o">[</span>10.96.0.1 192.168.96.151<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;apiserver-kubelet-client&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;front-proxy-ca&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;front-proxy-client&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;etcd/ca&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;etcd/server&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> etcd/server serving cert is signed <span class="k">for</span> DNS names <span class="o">[</span>localhost node1<span class="o">]</span> and IPs <span class="o">[</span>192.168.96.151 127.0.0.1 ::1<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;etcd/peer&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> etcd/peer serving cert is signed <span class="k">for</span> DNS names <span class="o">[</span>localhost node1<span class="o">]</span> and IPs <span class="o">[</span>192.168.96.151 127.0.0.1 ::1<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;etcd/healthcheck-client&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;apiserver-etcd-client&#34;</span> certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>certs<span class="o">]</span> Generating <span class="s2">&#34;sa&#34;</span> key and public key
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubeconfig<span class="o">]</span> Using kubeconfig folder <span class="s2">&#34;/etc/kubernetes&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubeconfig<span class="o">]</span> Writing <span class="s2">&#34;admin.conf&#34;</span> kubeconfig file
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubeconfig<span class="o">]</span> Writing <span class="s2">&#34;kubelet.conf&#34;</span> kubeconfig file
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubeconfig<span class="o">]</span> Writing <span class="s2">&#34;controller-manager.conf&#34;</span> kubeconfig file
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubeconfig<span class="o">]</span> Writing <span class="s2">&#34;scheduler.conf&#34;</span> kubeconfig file
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubelet-start<span class="o">]</span> Writing kubelet environment file with flags to file <span class="s2">&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubelet-start<span class="o">]</span> Writing kubelet configuration to file <span class="s2">&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubelet-start<span class="o">]</span> Starting the kubelet
</span></span><span class="line"><span class="cl"><span class="o">[</span>control-plane<span class="o">]</span> Using manifest folder <span class="s2">&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>control-plane<span class="o">]</span> Creating static Pod manifest <span class="k">for</span> <span class="s2">&#34;kube-apiserver&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>control-plane<span class="o">]</span> Creating static Pod manifest <span class="k">for</span> <span class="s2">&#34;kube-controller-manager&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>control-plane<span class="o">]</span> Creating static Pod manifest <span class="k">for</span> <span class="s2">&#34;kube-scheduler&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>etcd<span class="o">]</span> Creating static Pod manifest <span class="k">for</span> <span class="nb">local</span> etcd in <span class="s2">&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>wait-control-plane<span class="o">]</span> Waiting <span class="k">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="s2">&#34;/etc/kubernetes/manifests&#34;</span>. This can take up to 4m0s
</span></span><span class="line"><span class="cl"><span class="o">[</span>apiclient<span class="o">]</span> All control plane components are healthy after 17.506804 seconds
</span></span><span class="line"><span class="cl"><span class="o">[</span>upload-config<span class="o">]</span> Storing the configuration used in ConfigMap <span class="s2">&#34;kubeadm-config&#34;</span> in the <span class="s2">&#34;kube-system&#34;</span> Namespace
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubelet<span class="o">]</span> Creating a ConfigMap <span class="s2">&#34;kubelet-config&#34;</span> in namespace kube-system with the configuration <span class="k">for</span> the kubelets in the cluster
</span></span><span class="line"><span class="cl"><span class="o">[</span>upload-certs<span class="o">]</span> Skipping phase. Please see --upload-certs
</span></span><span class="line"><span class="cl"><span class="o">[</span>mark-control-plane<span class="o">]</span> Marking the node node1 as control-plane by adding the labels: <span class="o">[</span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mark-control-plane<span class="o">]</span> Marking the node node1 as control-plane by adding the taints <span class="o">[</span>node-role.kubernetes.io/master:PreferNoSchedule<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Using token: uufqmm.bvtfj4drwfvvbcev
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span class="k">for</span> nodes to get long term certificate credentials
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Configured RBAC rules to allow certificate rotation <span class="k">for</span> all node client certificates in the cluster
</span></span><span class="line"><span class="cl"><span class="o">[</span>bootstrap-token<span class="o">]</span> Creating the <span class="s2">&#34;cluster-info&#34;</span> ConfigMap in the <span class="s2">&#34;kube-public&#34;</span> namespace
</span></span><span class="line"><span class="cl"><span class="o">[</span>kubelet-finalize<span class="o">]</span> Updating <span class="s2">&#34;/etc/kubernetes/kubelet.conf&#34;</span> to point to a rotatable kubelet client certificate and key
</span></span><span class="line"><span class="cl"><span class="o">[</span>addons<span class="o">]</span> Applied essential addon: CoreDNS
</span></span><span class="line"><span class="cl"><span class="o">[</span>addons<span class="o">]</span> Applied essential addon: kube-proxy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Your Kubernetes control-plane has initialized successfully!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To start using your cluster, you need to run the following as a regular user:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">  sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">  sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Alternatively, <span class="k">if</span> you are the root user, you can run:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You should now deploy a pod network to the cluster.
</span></span><span class="line"><span class="cl">Run <span class="s2">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span class="line"><span class="cl">  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Then you can join any number of worker nodes by running the following on each as root:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubeadm join 192.168.10.20:6443 --token uufqmm.bvtfj4drwfvvbcev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--discovery-token-ca-cert-hash sha256:5814415567d93f6d2d41fe4719be8221f45c29c482b5059aec2e27a832ac36e6
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢è®°å½•äº†å®Œæˆçš„åˆå§‹åŒ–è¾“å‡ºçš„å†…å®¹ï¼Œæ ¹æ®è¾“å‡ºçš„å†…å®¹åŸºæœ¬ä¸Šå¯ä»¥çœ‹å‡ºæ‰‹åŠ¨åˆå§‹åŒ–å®‰è£…ä¸€ä¸ªKubernetesé›†ç¾¤æ‰€éœ€è¦çš„å…³é”®æ­¥éª¤ã€‚ å…¶ä¸­æœ‰ä»¥ä¸‹å…³é”®å†…å®¹ï¼š</p>
<ul>
<li>
<p><code>[certs]</code>ç”Ÿæˆç›¸å…³çš„å„ç§è¯ä¹¦</p>
</li>
<li>
<p><code>[kubeconfig]</code>ç”Ÿæˆç›¸å…³çš„kubeconfigæ–‡ä»¶</p>
</li>
<li>
<p><code>[kubelet-start]</code> ç”Ÿæˆkubeletçš„é…ç½®æ–‡ä»¶&quot;/var/lib/kubelet/config.yaml&quot;</p>
</li>
<li>
<p><code>[control-plane]</code>ä½¿ç”¨<code>/etc/kubernetes/manifests</code>ç›®å½•ä¸­çš„yamlæ–‡ä»¶åˆ›å»ºapiserverã€controller-managerã€schedulerçš„é™æ€pod</p>
</li>
<li>
<p><code>[bootstraptoken]</code>ç”Ÿæˆtokenè®°å½•ä¸‹æ¥ï¼Œåè¾¹ä½¿ç”¨<code>kubeadm join</code>å¾€é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹æ—¶ä¼šç”¨åˆ°</p>
</li>
<li>
<p>ä¸‹é¢çš„å‘½ä»¤æ˜¯é…ç½®å¸¸è§„ç”¨æˆ·å¦‚ä½•ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤ï¼šmasterèŠ‚ç‚¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æœ€åç»™å‡ºäº†å°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm join 192.168.10.20:6443 --token uufqmm.bvtfj4drwfvvbcev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--discovery-token-ca-cert-hash sha256:5814415567d93f6d2d41fe4719be8221f45c29c482b5059aec2e27a832ac36e6
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>æŸ¥çœ‹ä¸€ä¸‹é›†ç¾¤çŠ¶æ€ï¼Œç¡®è®¤ä¸ªç»„ä»¶éƒ½å¤„äºhealthyçŠ¶æ€ï¼Œç»“æœå‡ºç°äº†é”™è¯¯:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get cs
</span></span><span class="line"><span class="cl">Warning: v1 ComponentStatus is deprecated in v1.19+
</span></span><span class="line"><span class="cl">NAME                 STATUS    MESSAGE                         ERROR
</span></span><span class="line"><span class="cl">scheduler            Healthy   ok
</span></span><span class="line"><span class="cl">controller-manager   Healthy   ok
</span></span><span class="line"><span class="cl">etcd-0               Healthy   <span class="o">{</span><span class="s2">&#34;health&#34;</span>:<span class="s2">&#34;true&#34;</span>,<span class="s2">&#34;reason&#34;</span>:<span class="s2">&#34;&#34;</span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="22-kubeadm-reset">2.2 kubeadm reset</h2>
<p>é›†ç¾¤åˆå§‹åŒ–å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm reset
</span></span><span class="line"><span class="cl">iptables -F <span class="o">&amp;&amp;</span> iptables -t nat -F <span class="o">&amp;&amp;</span> iptables -t mangle -F <span class="o">&amp;&amp;</span> iptables -X
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘½ä»¤è¿›è¡Œæ¸…ç†ã€‚</p>
<h2 id="23-å®‰è£…helm-3">2.3 å®‰è£…helm 3</h2>
<p>Helmæ˜¯Kubernetesçš„åŒ…ç®¡ç†å™¨ï¼Œåç»­æµç¨‹ä¹Ÿå°†ä½¿ç”¨Helmå®‰è£…Kubernetesçš„å¸¸ç”¨ç»„ä»¶ã€‚ è¿™é‡Œå…ˆåœ¨masterèŠ‚ç‚¹node1ä¸Šå®‰è£…helmã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://repo.huaweicloud.com/helm/v3.11.2/helm-v3.11.2-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">tar -zxvf helm-v3.9.0-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">mv linux-amd64/helm  /usr/local/bin/
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="24-éƒ¨ç½²networkç»„ä»¶calico">2.4 éƒ¨ç½²Networkç»„ä»¶Calico</h2>
<p><a class="link" href="https://www.golinuxcloud.com/calico-kubernetes/"  target="_blank" rel="noopener"
    >https://www.golinuxcloud.com/calico-kubernetes/</a></p>
<p><a class="link" href="https://blog.csdn.net/qq_34556414/article/details/114937418"  target="_blank" rel="noopener"
    >https://blog.csdn.net/qq_34556414/article/details/114937418</a></p>
<p><a class="link" href="https://www.cnblogs.com/Cylon/p/14399682.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/Cylon/p/14399682.html</a></p>
<p><a class="link" href="https://blog.csdn.net/maomao5945/article/details/100773007"  target="_blank" rel="noopener"
    >https://blog.csdn.net/maomao5945/article/details/100773007</a></p>
<h4 id="install-calico">Install Calico</h4>
<ol>
<li>
<p>Download Calico CNI plugin</p>
<p>We will download the Calico networking manifest and use it to install the plugin for the Kubernetes API datastore.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@controller ~]# wget https://docs.projectcalico.org/v3.25/manifests/calico.yaml
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Modify pod CIDR (Optional)</p>
<p>Next you must assign a pod CIDR subnet. CIDR stands for Classless Inter-Domain Routing, also known as <em>supernetting</em>. By default Calico assumes that you wish to assign <code>192.168.0.0/16</code> subnet for the pod network but if you wish to choose any other subnet then you can add the same in <code>calico.yaml</code> file.</p>
<p>I am already using <code>192.168.0.0/24</code> for my Kubernetes Cluster and I don&rsquo;t want to use the same range for my Pods. So I will assign a random subnet <code>10.142.0.0/24</code> as my CIDR for pods.</p>
<p>We will open the <code>calico.yaml</code> using vim editor and modify <code>CALICO_IPV4POOL_CIDR</code> variable in the manifest and set it to <code>10.142.0.0/24</code> as shown below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">            - name: CALICO_IPV4POOL_CIDR
</span></span><span class="line"><span class="cl">              value: &#34;10.142.0.0/24&#34;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Install Calico Plugin</p>
<p>Next we can go ahead and install the Calico network using <code>kubectl</code> command with calico manifest file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@controller ~]# kubectl apply -f calico.yaml
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Confirm that all of the pods are running with the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">watch kubectl get pods -n kube-system
</span></span></code></pre></td></tr></table>
</div>
</div><p>Wait until each pod has the <code>STATUS</code> of <code>Running</code>.</p>
<blockquote>
<p><strong>Note</strong>: The Tigera operator installs resources in the <code>calico-system</code> namespace. Other install methods may use the <code>kube-system</code> namespace instead.</p>
</blockquote>
</li>
</ol>
<p><a class="link" href="https://www.tigera.io/blog/advertising-kubernetes-service-ips-with-calico-and-bgp/"  target="_blank" rel="noopener"
    >https://www.tigera.io/blog/advertising-kubernetes-service-ips-with-calico-and-bgp/</a></p>
<p>host network</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">calicoctl apply -f - <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: projectcalico.org/v3
</span></span></span><span class="line"><span class="cl"><span class="s">kind: BGPPeer
</span></span></span><span class="line"><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s">  name: bgppeer-global-64512
</span></span></span><span class="line"><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="cl"><span class="s">  peerIP: 192.168.10.6
</span></span></span><span class="line"><span class="cl"><span class="s">  asNumber: 64512
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>pod network  service network</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">calicoctl create -f - &lt;&lt;EOF
</span></span><span class="line"><span class="cl">apiVersion: projectcalico.org/v3
</span></span><span class="line"><span class="cl">kind: BGPConfiguration
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: default
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  serviceClusterIPs:
</span></span><span class="line"><span class="cl">  - cidr: 10.96.0.0/12
</span></span><span class="line"><span class="cl">  - cidr: 10.16.0.0/12
</span></span><span class="line"><span class="cl">EOF
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€‰æ‹©calicoä½œä¸ºk8sçš„Podç½‘ç»œç»„ä»¶ï¼Œä¸‹é¢ä½¿ç”¨helmåœ¨k8sé›†ç¾¤ä¸­å®‰è£…calicoã€‚</p>
<p>ä¸‹è½½<code>tigera-operator</code>çš„<code>helm chart</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/projectcalico/calico/releases/download/v3.23.1/tigera-operator-v3.23.1.tgz
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹è¿™ä¸ªchartçš„ä¸­å¯å®šåˆ¶çš„é…ç½®:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">helm show values tigera-operator-v3.23.1.tgz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">installation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kubernetesProvider</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiServer</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">certs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">node</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cert</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">commonName</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">typha</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cert</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">commonName</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">caBundle</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Configuration for the tigera operator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">tigeraOperator</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tigera/operator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.27.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="l">quay.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">calicoctl</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/calico/ctl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">v3.23.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®šåˆ¶çš„<code>values.yaml</code>å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å¯é’ˆå¯¹ä¸Šé¢çš„é…ç½®è¿›è¡Œå®šåˆ¶,ä¾‹å¦‚calicoçš„é•œåƒæ”¹æˆä»ç§æœ‰åº“æ‹‰å–ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œåªæ˜¯ä¸ªäººæœ¬åœ°ç¯å¢ƒæµ‹è¯•k8sæ–°ç‰ˆæœ¬ï¼Œå› æ­¤ä¿ç•™value.yamlä¸ºç©ºå³å¯</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨helmå®‰è£…calicoï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm install calico tigera-operator-v3.23.1.tgz -n kube-system  --create-namespace -f values.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç­‰å¾…å¹¶ç¡®è®¤æ‰€æœ‰podå¤„äºRunningçŠ¶æ€:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pod -n kube-system <span class="p">|</span> grep tigera-operator
</span></span><span class="line"><span class="cl">tigera-operator-5fb55776df-wxbph   1/1     Running   <span class="m">0</span>             5m10s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get pods -n calico-system
</span></span><span class="line"><span class="cl">NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">calico-kube-controllers-68884f975d-5d7p9   1/1     Running   <span class="m">0</span>          5m24s
</span></span><span class="line"><span class="cl">calico-node-twbdh                          1/1     Running   <span class="m">0</span>          5m24s
</span></span><span class="line"><span class="cl">calico-typha-7b4bdd99c5-ssdn2              1/1     Running   <span class="m">0</span>          5m24s
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ä¸€ä¸‹calicoå‘k8sä¸­æ·»åŠ çš„apièµ„æº:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl api-resources <span class="p">|</span> grep calico
</span></span><span class="line"><span class="cl">bgpconfigurations                                                                 crd.projectcalico.org/v1               <span class="nb">false</span>        BGPConfiguration
</span></span><span class="line"><span class="cl">bgppeers                                                                          crd.projectcalico.org/v1               <span class="nb">false</span>        BGPPeer
</span></span><span class="line"><span class="cl">blockaffinities                                                                   crd.projectcalico.org/v1               <span class="nb">false</span>        BlockAffinity
</span></span><span class="line"><span class="cl">caliconodestatuses                                                                crd.projectcalico.org/v1               <span class="nb">false</span>        CalicoNodeStatus
</span></span><span class="line"><span class="cl">clusterinformations                                                               crd.projectcalico.org/v1               <span class="nb">false</span>        ClusterInformation
</span></span><span class="line"><span class="cl">felixconfigurations                                                               crd.projectcalico.org/v1               <span class="nb">false</span>        FelixConfiguration
</span></span><span class="line"><span class="cl">globalnetworkpolicies                                                             crd.projectcalico.org/v1               <span class="nb">false</span>        GlobalNetworkPolicy
</span></span><span class="line"><span class="cl">globalnetworksets                                                                 crd.projectcalico.org/v1               <span class="nb">false</span>        GlobalNetworkSet
</span></span><span class="line"><span class="cl">hostendpoints                                                                     crd.projectcalico.org/v1               <span class="nb">false</span>        HostEndpoint
</span></span><span class="line"><span class="cl">ipamblocks                                                                        crd.projectcalico.org/v1               <span class="nb">false</span>        IPAMBlock
</span></span><span class="line"><span class="cl">ipamconfigs                                                                       crd.projectcalico.org/v1               <span class="nb">false</span>        IPAMConfig
</span></span><span class="line"><span class="cl">ipamhandles                                                                       crd.projectcalico.org/v1               <span class="nb">false</span>        IPAMHandle
</span></span><span class="line"><span class="cl">ippools                                                                           crd.projectcalico.org/v1               <span class="nb">false</span>        IPPool
</span></span><span class="line"><span class="cl">ipreservations                                                                    crd.projectcalico.org/v1               <span class="nb">false</span>        IPReservation
</span></span><span class="line"><span class="cl">kubecontrollersconfigurations                                                     crd.projectcalico.org/v1               <span class="nb">false</span>        KubeControllersConfiguration
</span></span><span class="line"><span class="cl">networkpolicies                                                                   crd.projectcalico.org/v1               <span class="nb">true</span>         NetworkPolicy
</span></span><span class="line"><span class="cl">networksets                                                                       crd.projectcalico.org/v1               <span class="nb">true</span>         NetworkSet
</span></span><span class="line"><span class="cl">bgpconfigurations                 bgpconfig,bgpconfigs                            projectcalico.org/v3                   <span class="nb">false</span>        BGPConfiguration
</span></span><span class="line"><span class="cl">bgppeers                                                                          projectcalico.org/v3                   <span class="nb">false</span>        BGPPeer
</span></span><span class="line"><span class="cl">caliconodestatuses                caliconodestatus                                projectcalico.org/v3                   <span class="nb">false</span>        CalicoNodeStatus
</span></span><span class="line"><span class="cl">clusterinformations               clusterinfo                                     projectcalico.org/v3                   <span class="nb">false</span>        ClusterInformation
</span></span><span class="line"><span class="cl">felixconfigurations               felixconfig,felixconfigs                        projectcalico.org/v3                   <span class="nb">false</span>        FelixConfiguration
</span></span><span class="line"><span class="cl">globalnetworkpolicies             gnp,cgnp,calicoglobalnetworkpolicies            projectcalico.org/v3                   <span class="nb">false</span>        GlobalNetworkPolicy
</span></span><span class="line"><span class="cl">globalnetworksets                                                                 projectcalico.org/v3                   <span class="nb">false</span>        GlobalNetworkSet
</span></span><span class="line"><span class="cl">hostendpoints                     hep,heps                                        projectcalico.org/v3                   <span class="nb">false</span>        HostEndpoint
</span></span><span class="line"><span class="cl">ippools                                                                           projectcalico.org/v3                   <span class="nb">false</span>        IPPool
</span></span><span class="line"><span class="cl">ipreservations                                                                    projectcalico.org/v3                   <span class="nb">false</span>        IPReservation
</span></span><span class="line"><span class="cl">kubecontrollersconfigurations                                                     projectcalico.org/v3                   <span class="nb">false</span>        KubeControllersConfiguration
</span></span><span class="line"><span class="cl">networkpolicies                   cnp,caliconetworkpolicy,caliconetworkpolicies   projectcalico.org/v3                   <span class="nb">true</span>         NetworkPolicy
</span></span><span class="line"><span class="cl">networksets                       netsets                                         projectcalico.org/v3                   <span class="nb">true</span>         NetworkSet
</span></span><span class="line"><span class="cl">profiles                                                                          projectcalico.org/v3                   <span class="nb">false</span>        Profile
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™äº›apièµ„æºæ˜¯å±äºcalicoçš„ï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨kubectlæ¥ç®¡ç†ï¼Œæ¨èæŒ‰ç…§calicoctlæ¥ç®¡ç†è¿™äº›apièµ„æºã€‚ å°†calicoctlå®‰è£…ä¸ºkubectlçš„æ’ä»¶:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /usr/local/bin
</span></span><span class="line"><span class="cl">curl -o kubectl-calico -O -L  <span class="s2">&#34;https://github.com/projectcalico/calicoctl/releases/download/v3.21.5/calicoctl-linux-amd64&#34;</span> 
</span></span><span class="line"><span class="cl">chmod +x kubectl-calico
</span></span></code></pre></td></tr></table>
</div>
</div><p>éªŒè¯æ’ä»¶æ­£å¸¸å·¥ä½œ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl calico -h
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="24-éƒ¨ç½²networkç»„ä»¶kube-ovn">2.4 éƒ¨ç½²Networkç»„ä»¶kube-ovn</h2>
<p>å®‰è£…install.shä¹‹å‰ç¡®è®¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">--pod-network-cidr<span class="o">=</span>10.16.0.0/16 
</span></span><span class="line"><span class="cl">--service-cidr<span class="o">=</span>10.96.0.0/12
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å’Œinstall.shé‡Œé¢çš„POD_CIDRã€SVC_CIDRä¸€è‡´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">POD_CIDR</span><span class="o">=</span><span class="s2">&#34;10.16.0.0/16&#34;</span>                <span class="c1"># Do NOT overlap with NODE/SVC/JOIN CIDR</span>
</span></span><span class="line"><span class="cl"><span class="nv">POD_GATEWAY</span><span class="o">=</span><span class="s2">&#34;10.16.0.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">SVC_CIDR</span><span class="o">=</span><span class="s2">&#34;10.96.0.0/12&#34;</span>                <span class="c1"># Do NOT overlap with NODE/POD/JOIN CIDR</span>
</span></span><span class="line"><span class="cl"><span class="nv">JOIN_CIDR</span><span class="o">=</span><span class="s2">&#34;100.64.0.0/16&#34;</span>              <span class="c1"># Do NOT overlap with NODE/POD/SVC CIDR</span>
</span></span><span class="line"><span class="cl"><span class="nv">PINGER_EXTERNAL_ADDRESS</span><span class="o">=</span><span class="s2">&#34;114.114.114.114&#34;</span>  <span class="c1"># Pinger check external ip probe</span>
</span></span><span class="line"><span class="cl"><span class="nv">PINGER_EXTERNAL_DOMAIN</span><span class="o">=</span><span class="s2">&#34;alauda.cn&#34;</span>         <span class="c1"># Pinger check external domain probe</span>
</span></span><span class="line"><span class="cl"><span class="nv">SVC_YAML_IPFAMILYPOLICY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œå®‰è£…è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://raw.githubusercontent.com/kubeovn/kube-ovn/master/dist/images/install.sh -o install.sh
</span></span><span class="line"><span class="cl">sh install.sh
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="25-éªŒè¯k8s-dnsæ˜¯å¦å¯ç”¨">2.5 éªŒè¯k8s DNSæ˜¯å¦å¯ç”¨</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl run curl --image<span class="o">=</span>radial/busyboxplus:curl -it
</span></span><span class="line"><span class="cl">If you don<span class="err">&#39;</span>t see a <span class="nb">command</span> prompt, try pressing enter.
</span></span><span class="line"><span class="cl"><span class="o">[</span> root@curl:/ <span class="o">]</span>$
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥åæ‰§è¡Œ<code>nslookup kubernetes.default</code>ç¡®è®¤è§£ææ­£å¸¸:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">nslookup kubernetes.default
</span></span><span class="line"><span class="cl">Server:    10.96.0.10
</span></span><span class="line"><span class="cl">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name:      kubernetes.default
</span></span><span class="line"><span class="cl">Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="26-æ·»åŠ nodeèŠ‚ç‚¹">2.6 æ·»åŠ NodeèŠ‚ç‚¹</h2>
<p>ä¸‹é¢å°†node2, node3æ·»åŠ åˆ°Kubernetesé›†ç¾¤ä¸­ï¼Œåˆ†åˆ«åœ¨node01, node02, node03ä¸Šæ‰§è¡Œ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubeadm join 192.168.10.20:6443 --token uufqmm.bvtfj4drwfvvbcev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--discovery-token-ca-cert-hash sha256:5814415567d93f6d2d41fe4719be8221f45c29c482b5059aec2e27a832ac36e6
</span></span></code></pre></td></tr></table>
</div>
</div><p>node01, node02, node03åŠ å…¥é›†ç¾¤å¾ˆæ˜¯é¡ºåˆ©ï¼Œåœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get nodes</span>
</span></span><span class="line"><span class="cl">NAME     STATUS   ROLES           AGE    VERSION
</span></span><span class="line"><span class="cl">master   Ready    control-plane   7h3m   v1.24.3
</span></span><span class="line"><span class="cl">node01   Ready    &lt;none&gt;          7h2m   v1.24.3
</span></span><span class="line"><span class="cl">node02   Ready    &lt;none&gt;          7h2m   v1.24.3
</span></span><span class="line"><span class="cl">node03   Ready    &lt;none&gt;          7h2m   v1.24.3
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="multus-networking">Multus Networking</h1>
<h1 id="redis-operrator">redis operrator</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl  create ns operator-redis-ibm
</span></span><span class="line"><span class="cl">kubectl  apply -f ../redis-rbac.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">helm install op charts/operator-for-redis --wait --set image.repository=ibmcom/operator-for-redis --set image.tag=latest  -n operator-redis-ibm
</span></span><span class="line"><span class="cl">helm install --wait mycluster charts/node-for-redis --set image.repository=ibmcom/node-for-redis --set image.tag=latest -n operator-redis-ibm
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="3-ipvsæ”¯æŒ">3. ipvsæ”¯æŒ</h1>
<p>1.å¯ç”¨netfilteræ¨¡å—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">modprobe br_netfilter
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.ä¿®æ”¹å†…æ ¸å‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF
</span></span><span class="line"><span class="cl">net.bridge.bridge-nf-call-ip6tables = 1
</span></span><span class="line"><span class="cl">net.bridge.bridge-nf-call-iptables = 1
</span></span><span class="line"><span class="cl">net.ipv4.ip_forward = 1
</span></span><span class="line"><span class="cl">vm.swappiness = 0
</span></span><span class="line"><span class="cl">EOF
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">sysctl -p
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.å®‰è£…ipvsæ”¯æŒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum -y install ipvsadm ipset
</span></span></code></pre></td></tr></table>
</div>
</div><p>4.å¯ç”¨ipvsæ¨¡å—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt; /etc/sysconfig/modules/ipvs.modules <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="s">modprobe -- ip_vs
</span></span></span><span class="line"><span class="cl"><span class="s">modprobe -- ip_vs_rr
</span></span></span><span class="line"><span class="cl"><span class="s">modprobe -- ip_vs_wrr
</span></span></span><span class="line"><span class="cl"><span class="s">modprobe -- ip_vs_sh
</span></span></span><span class="line"><span class="cl"><span class="s">modprobe -- nf_conntrack_ipv4
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /etc/sysconfig/modules/ipvs.modules
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /etc/sysconfig/modules/ipvs.modules
</span></span></code></pre></td></tr></table>
</div>
</div><p>5.ä¿®æ”¹configmapå¹¶é‡å¯kube-proxy</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl edit cm kube-proxy -n kube-system  # mode: &#34;ipvs&#34;
</span></span><span class="line"><span class="cl">kubectl get pod -n kube-system | grep kube-proxy | awk &#39;{print $1}&#39; | xargs kubectl -n kube-system delete pod
</span></span></code></pre></td></tr></table>
</div>
</div><p>6.éªŒè¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ipvsadm -Ln
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="4-kuberneteså¸¸ç”¨ç»„ä»¶éƒ¨ç½²">4. Kuberneteså¸¸ç”¨ç»„ä»¶éƒ¨ç½²</h1>
<h2 id="remotewriteä½¿èƒ½">remoteWriteä½¿èƒ½</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">remoteWrite</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://192.168.10.200:8428/api/v1/write</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="41-å®‰è£…prometheus-grafana">4.1 å®‰è£…Prometheus Grafana</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/prometheus-operator/kube-prometheus
</span></span><span class="line"><span class="cl">kubectl apply --server-side -f kube-prometheus/manifests/setup
</span></span><span class="line"><span class="cl">kubectl apply --server-side -f kube-prometheus/manifests
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ç‰ˆæœ¬å¯¹åº”ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>kube-prometheus stack</th>
<th>Kubernetes 1.21</th>
<th>Kubernetes 1.22</th>
<th>Kubernetes 1.23</th>
<th>Kubernetes 1.24</th>
<th>Kubernetes 1.25</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="link" href="https://github.com/prometheus-operator/kube-prometheus/tree/release-0.11"  target="_blank" rel="noopener"
    ><code>release-0.11</code></a></td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ—</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/prometheus-operator/kube-prometheus/tree/release-0.12"  target="_blank" rel="noopener"
    ><code>release-0.12</code></a></td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/prometheus-operator/kube-prometheus/tree/main"  target="_blank" rel="noopener"
    ><code>main</code></a></td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ—</td>
<td>âœ”</td>
</tr>
</tbody>
</table></div>
<p>Network Policiesä¼šå¯¼è‡´èŠ‚ç‚¹è®¿é—®é™åˆ¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nd">@master</span> <span class="n">manifests</span><span class="p">]</span><span class="c1"># ls -alrth *networkPolicy*</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">694</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">prometheusOperator</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">564</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">prometheusAdapter</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">671</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">nodeExporter</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">723</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">kubeStateMetrics</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">722</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">blackboxExporter</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">977</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">22</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span> <span class="n">alertmanager</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">651</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">24</span> <span class="mi">10</span><span class="p">:</span><span class="mi">16</span> <span class="n">grafana</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mf">1.1</span><span class="n">K</span> <span class="mi">7</span><span class="n">æœˆ</span>  <span class="mi">24</span> <span class="mi">14</span><span class="p">:</span><span class="mi">40</span> <span class="n">prometheus</span><span class="o">-</span><span class="n">networkPolicy</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="42-å®‰è£…ingress-nginx">4.2 å®‰è£…ingress-nginx</h2>
<p><a class="link" href="https://github.com/kubernetes/ingress-nginx"  target="_blank" rel="noopener"
    >https://github.com/kubernetes/ingress-nginx</a></p>
<p>é»˜è®¤æ˜¯ï¼Œdaemonsetå®‰è£…å‰éœ€è¦ç»™nodeæ‰“æ ‡ç­¾edgenodeï¼Œå®‰è£…åœ¨edgenodeä¸Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl label nodes node02 <span class="nv">edgenode</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">kubectl label nodes node03 <span class="nv">edgenode</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">kubectl get node --show-labels
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œè„šæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.7.1/deploy/static/provider/cloud/deploy.yaml -O ingress/ingress-nginx-deploy-daemonset.yaml
</span></span><span class="line"><span class="cl">kubectl apply -f ingress/ingress-nginx-deploy-daemonset.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ¬¡é‡‡ç”¨daemonsetå®‰è£…ï¼Œéœ€è¦ä¿®æ”¹ä¸‹é¢ä¸¤å¤„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">edgenode</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®Œæ•´é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">minReadySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;10254&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/scrape</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">/nginx-ingress-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">election-id=ingress-controller-leader</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">controller-class=k8s.io/ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">ingress-class=nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook=:8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook-certificate=/usr/local/certificates/cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook-key=/usr/local/certificates/key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAMESPACE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">LD_PRELOAD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/lib/libmimalloc.so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">anjia0532/google-containers.ingress-nginx.controller:v1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">/wait-shutdown</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">90Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">add</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">NET_BIND_SERVICE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">101</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/certificates/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterFirst</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">edgenode</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">300</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Ingress-NGINX version</th>
<th>k8s supported version</th>
<th>Alpine Version</th>
<th>Nginx Version</th>
<th>Helm Chart Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>v1.7.1</strong></td>
<td>1.27,1.26, 1.25, 1.24</td>
<td>3.17.2</td>
<td>1.21.6</td>
<td>4.6.*</td>
</tr>
<tr>
<td><strong>v1.7.0</strong></td>
<td>1.26, 1.25, 1.24</td>
<td>3.17.2</td>
<td>1.21.6</td>
<td>4.6.*</td>
</tr>
<tr>
<td><strong>v1.6.4</strong></td>
<td>1.26, 1.25, 1.24, 1.23</td>
<td>3.17.0</td>
<td>1.21.6</td>
<td>4.5.*</td>
</tr>
</tbody>
</table></div>
<h2 id="43-ç”ŸæˆåŸŸåè¯ä¹¦">4.3 ç”ŸæˆåŸŸåè¯ä¹¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./gen.cert.sh test.dev minio.test.dev
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="44-å¯¼å…¥è¯ä¹¦">4.4 å¯¼å…¥è¯ä¹¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create secret  tls test.dev  --key test.dev.key --cert test.dev.crt -n ns-test
</span></span><span class="line"><span class="cl">kubectl create secret  tls test.dev  --key test.dev.key --cert test.dev.crt -n monitoring
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="45-ingressè½¬å‘prometheus-grafana">4.5 ingressè½¬å‘prometheus grafana</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f ingress/ingress-grafana-prometheus-service.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="46-ingressè½¬å‘nginxæµ‹è¯•æœåŠ¡">4.6 ingressè½¬å‘nginxæµ‹è¯•æœåŠ¡</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create namespace ns-test
</span></span><span class="line"><span class="cl">kubectl apply -f nginx/nginx-deployment.yaml
</span></span><span class="line"><span class="cl">kubectl apply -f nginx/nginx-service.yaml
</span></span><span class="line"><span class="cl">kubectl apply -f ingress/ingress-nginx-service.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="5-å®‰è£…bashbord">5. å®‰è£…bashbord</h1>
<p><a class="link" href="https://github.com/kubernetes/dashboard/tree/v2.6.0/aio/deploy"  target="_blank" rel="noopener"
    >https://github.com/kubernetes/dashboard/tree/v2.6.0/aio/deploy</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
</span></span><span class="line"><span class="cl">kubectl apply -f recommended.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget https:*//raw.githubusercontent.com/cby-chen/Kubernetes/main/yaml/dashboard-user.yaml*
</span></span><span class="line"><span class="cl">kubectl apply -f dashboard-user.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¿®æ”¹ä¸ºnodeport">ä¿®æ”¹ä¸ºnodePort</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root@k8s-master01:~# kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard
</span></span><span class="line"><span class="cl">service/kubernetes-dashboard edited
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@k8s-master01:~# kubectl get svc kubernetes-dashboard -n kubernetes-dashboard
</span></span><span class="line"><span class="cl">NAME                   TYPE       CLUSTER-IP    EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>         AGE
</span></span><span class="line"><span class="cl">kubernetes-dashboard   NodePort   10.96.221.8   &lt;none&gt;        443:32721/TCP   74s
</span></span><span class="line"><span class="cl">root@k8s-master01:~#
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¯¼å…¥è¯ä¹¦">å¯¼å…¥è¯ä¹¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create secret  tls test.dev  --key test.dev.key --cert test.dev.crt -n kubernetes-dashboard
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ›å»ºtoken">åˆ›å»ºtoken</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubernetes-dashboard create token admin-user
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dashboard-rbacyaml">dashboard-rbac.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">admin-user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes-dashboard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">admin-user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cluster-admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">admin-user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes-dashboard</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ingress-bashbordyaml">ingress-bashbord.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-kubernetes-dashboard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes-dashboard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;on&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;HTTPS&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">dashboard.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">dashboard.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes-dashboard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="6-é™æ€pv">6 é™æ€PV</h1>
<ol>
<li>å‡†å¤‡ä¸€å°æœºå™¨ï¼Œæ­å»ºNFSæœåŠ¡</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install nfs-utils
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">echo</span> <span class="s2">&#34;/data/k8s/ 192.168.10.0/24(sync,rw,no_root_squash)&#34;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">exports</span>
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">exports</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">systemctl</span> <span class="n">start</span> <span class="n">nfs</span><span class="p">;</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">rpcbind</span> 
</span></span><span class="line"><span class="cl"><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nfs</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>åœ¨nodeèŠ‚ç‚¹ä¸Šæµ‹è¯•</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install nfs-utils
</span></span><span class="line"><span class="cl">showmount -e 192.168.10.128
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>åˆ›å»ºpvï¼ˆmasterä¸Šï¼‰</li>
</ol>
<p>vim pv.yaml //å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f pv.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: PersistentVolume
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: pv001
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  capacity:
</span></span><span class="line"><span class="cl">    storage: 500Gi
</span></span><span class="line"><span class="cl">  accessModes:
</span></span><span class="line"><span class="cl">    - ReadWriteMany
</span></span><span class="line"><span class="cl">  nfs:
</span></span><span class="line"><span class="cl">    path: /data/k8s/
</span></span><span class="line"><span class="cl">    server: 192.168.10.12
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get pv
</span></span><span class="line"><span class="cl">[root@master pv]# kubectl get pv
</span></span><span class="line"><span class="cl">NAME    CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
</span></span><span class="line"><span class="cl">pv001   500Gi      RWX            Retain           Available                                   6m48s
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºpvc, pvc.yaml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f pvc.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kind: PersistentVolumeClaim
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: myclaim
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  accessModes:
</span></span><span class="line"><span class="cl">    - ReadWriteMany
</span></span><span class="line"><span class="cl">  resources:
</span></span><span class="line"><span class="cl">    requests:
</span></span><span class="line"><span class="cl">      storage: 500Gi
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master pv]# kubectl get pvc
</span></span><span class="line"><span class="cl">NAME                      STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class="line"><span class="cl">datadir-redis-cluster-0   Pending                                                     63m
</span></span><span class="line"><span class="cl">myclaim                   Bound     pv001    500Gi      RWX                           94s
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="7-åŠ¨æ€pvåˆ›å»º">7 åŠ¨æ€pvåˆ›å»º</h1>
<p><a class="link" href="https://blog.csdn.net/a13568hki/article/details/124351017"  target="_blank" rel="noopener"
    >https://blog.csdn.net/a13568hki/article/details/124351017</a></p>
<p><a class="link" href="https://artifacthub.io/packages/helm/nfs-subdir-external-provisioner/nfs-subdir-external-provisioner"  target="_blank" rel="noopener"
    >https://artifacthub.io/packages/helm/nfs-subdir-external-provisioner/nfs-subdir-external-provisioner</a></p>
<p><a class="link" href="https://fabianlee.org/2022/01/12/kubernetes-nfs-mount-using-dynamic-volume-and-storage-class/"  target="_blank" rel="noopener"
    >https://fabianlee.org/2022/01/12/kubernetes-nfs-mount-using-dynamic-volume-and-storage-class/</a></p>
<p>å®˜ç½‘ï¼š</p>
<p><a class="link" href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner"  target="_blank" rel="noopener"
    >https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></p>
<h2 id="nfs-client-provisioneryaml">nfs-client-provisioner.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-provisioner-01</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w"> </span><span class="c">#ä¸RBACæ–‡ä»¶ä¸­çš„namespaceä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Recreate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-provisioner-01</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-provisioner-01</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w"> </span><span class="c"># æŒ‡å®šserviceAccount!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">easzlab/nfs-subdir-external-provisioner:v4.0.2</span><span class="w"> </span><span class="c">#é•œåƒåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">  </span><span class="c"># æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨æŒ‡å®šç›®å½•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/persistentvolumes  </span><span class="w"> </span><span class="c">#ä¸éœ€è¦ä¿®æ”¹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">PROVISIONER_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-provisioner-01 </span><span class="w"> </span><span class="c"># æ­¤å¤„ä¾›åº”è€…åå­—ä¾›storageclassè°ƒç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">NFS_SERVER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.10.128</span><span class="w">   </span><span class="c"># å¡«å…¥NFSçš„åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">NFS_PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/data/k8s  </span><span class="w"> </span><span class="c"># å¡«å…¥NFSæŒ‚è½½çš„ç›®å½•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.10.128</span><span class="w">   </span><span class="c"># å¡«å…¥NFSçš„åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/data/k8s  </span><span class="w"> </span><span class="c"># å¡«å…¥NFSæŒ‚è½½çš„ç›®å½•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">storage.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StorageClass </span><span class="w"> </span><span class="c"># åˆ›å»ºStorageClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-boge</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storageclass.kubernetes.io/is-default-class</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-provisioner-01 </span><span class="w"> </span><span class="c">#è¿™é‡Œçš„åç§°è¦å’Œprovisioneré…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡PROVISIONER_NAMEä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Supported policies: Deleteã€ Retain ,default is Delete</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain  </span><span class="w"> </span><span class="c">#æ¸…é™¤ç­–ç•¥</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># nfs-rbac.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># replace with namespace where provisioner is deployed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default       </span><span class="w"> </span><span class="c">#æ ¹æ®å®é™…ç¯å¢ƒè®¾å®šnamespace,ä¸‹é¢ç±»åŒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner-runner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;persistentvolumes&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;watch&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;create&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;delete&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;persistentvolumeclaims&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;watch&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;update&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;storage.k8s.io&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;storageclasses&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;watch&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;events&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;create&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;update&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;patch&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">run-nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># replace with namespace where provisioner is deployed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner-runner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">leader-locking-nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># replace with namespace where provisioner is deployed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;endpoints&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;watch&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;create&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;update&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;patch&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">leader-locking-nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># replace with namespace where provisioner is deployed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">leader-locking-nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># nfs-StorageClass.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">storage.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StorageClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">managed-nfs-storage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storageclass.kubernetes.io/is-default-class</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-storage</span><span class="w"> </span><span class="c">#è¿™é‡Œçš„åç§°è¦å’Œprovisioneré…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡PROVISIONER_NAMEä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  archiveOnDelete: &#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">archiveOnDelete</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># nfs-provisioner.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># replace with namespace where provisioner is deployed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default </span><span class="w"> </span><span class="c">#ä¸RBACæ–‡ä»¶ä¸­çš„namespaceä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Recreate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-provisioner</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/easzlab/nfs-subdir-external-provisioner:v4.0.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#image: quay.io/external_storage/nfs-client-provisioner:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#è¿™é‡Œç‰¹åˆ«æ³¨æ„ï¼Œåœ¨k8s-1.20ä»¥åç‰ˆæœ¬ä¸­ä½¿ç”¨ä¸Šé¢æä¾›çš„åŒ…ï¼Œå¹¶ä¸å¥½ç”¨ï¼Œè¿™é‡Œæˆ‘æŠ˜è…¾äº†å¥½ä¹…ï¼Œæ‰è§£å†³ï¼Œåæ¥åœ¨å®˜æ–¹çš„githubä¸Šï¼Œåˆ«äººæçš„é—®é¢˜ä¸­å»ºè®®ä½¿ç”¨ä¸‹é¢è¿™ä¸ªåŒ…æ‰è§£å†³çš„ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸‹è½½åï¼Œä¼ åˆ°æˆ‘è‡ªå·²çš„ä»“åº“é‡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#easzlab/nfs-subdir-external-provisioner:v4.0.1 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c">#image: registry-op.test.cn/nfs-subdir-external-provisioner:v4.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/persistentvolumes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">PROVISIONER_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-storage </span><span class="w"> </span><span class="c">#provisioneråç§°,è¯·ç¡®ä¿è¯¥åç§°ä¸ nfs-StorageClass.yamlæ–‡ä»¶ä¸­çš„provisioneråç§°ä¿æŒä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">NFS_SERVER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.10.220</span><span class="w">   </span><span class="c">#NFS Server IPåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">NFS_PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/home/nfs&#34;</span><span class="w">    </span><span class="c">#NFSæŒ‚è½½å·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client-root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.10.220</span><span class="w">  </span><span class="c">#NFS Server IPåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/home/nfs&#34;</span><span class="w">     </span><span class="c">#NFS æŒ‚è½½å·</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="8-minioå®‰è£…">8 Minioå®‰è£…</h1>
<h2 id="å®‰è£…minio--operator">å®‰è£…minio  operator</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://github.com/minio/operator/releases/download/v4.4.28/kubectl-minio_4.4.28_linux_amd64 -O kubectl-minio
</span></span><span class="line"><span class="cl">chmod +x kubectl-minio
</span></span><span class="line"><span class="cl">mv kubectl-minio /usr/local/bin/
</span></span><span class="line"><span class="cl">kubectl minio init
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ§åˆ¶ç•Œé¢">æ§åˆ¶ç•Œé¢</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl minio proxy -n minio-operator
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ›å»ºminioé›†ç¾¤">åˆ›å»ºminioé›†ç¾¤</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl minio tenant create tenant1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--servers <span class="m">1</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--volumes <span class="m">4</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--capacity 1Gi <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--namespace tenant1
</span></span><span class="line"><span class="cl">--storage-class local-path
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç”Ÿæˆ3çº§åŸŸåè¯ä¹¦">ç”Ÿæˆ3çº§åŸŸåè¯ä¹¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gen.cert.sh minio.test.dev
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¯¼å…¥è¯ä¹¦-1">å¯¼å…¥è¯ä¹¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create secret  tls test.dev  --key test.dev.key --cert test.dev.crt -n tenant1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ingress-minioyaml">ingress-minio.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">tenant1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;on&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;HTTPS&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">apiminio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">web.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">api.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tenant1-console</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">web.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tenant1-console</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">apiminio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">api.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é…ç½®åŸŸåè§£æ">é…ç½®åŸŸåè§£æ</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">192.168.10.22 test.dev
</span></span><span class="line"><span class="cl">192.168.10.23 web.minio.test.dev
</span></span><span class="line"><span class="cl">192.168.10.22 minio.test.dev
</span></span><span class="line"><span class="cl">192.168.10.23 api.minio.test.dev
</span></span><span class="line"><span class="cl">192.168.10.22 apiminio.test.dev
</span></span><span class="line"><span class="cl">192.168.10.22 www.test.dev
</span></span><span class="line"><span class="cl">192.168.10.22 grafana.test.dev
</span></span><span class="line"><span class="cl">192.168.10.23 prometheus.test.dev
</span></span><span class="line"><span class="cl">192.168.10.23 dashboard.test.dev
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="413-request-entity-too-large">413 Request Entity Too Large</h2>
<h3 id="æ–¹æ¡ˆ1-ä¿®æ”¹è‡ªå·±çš„ingress">æ–¹æ¡ˆ1 ä¿®æ”¹è‡ªå·±çš„ingress</h3>
<p>nginx.ingress.kubernetes.io/proxy-body-size: 10m</p>
<p>æœ‰äº›åç«¯è‡ªå¸¦TLSè¯ä¹¦è¿™é‡Œå¿½ç•¥äº†åç«¯çš„è¯ä¹¦</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">tenant1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;on&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;HTTPS&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="p">:</span><span class="w"> </span><span class="l">10m</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–¹æ¡ˆ2-å…¨å±€-ingress-configmap">æ–¹æ¡ˆ2 å…¨å±€ ingress configmap</h3>
<p>proxy-body-size: 50000M</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow-snippet-annotations</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">proxy-body-size</span><span class="p">:</span><span class="w"> </span><span class="l">50000M</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="6-kube_proxy-serviceå’Œiptablesçš„å…³ç³»">6 kube_proxy serviceå’Œiptablesçš„å…³ç³»</h1>
<p>service çš„ä»£ç†æ˜¯ kube-proxy</p>
<p>kube-proxy è¿è¡Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œå®ƒç›‘å¬ apiserver ä¸­ service å’Œ endpoint çš„å˜åŒ–æƒ…å†µï¼Œåˆ›å»ºè·¯ç”±è§„åˆ™ä»¥æä¾›æœåŠ¡ IP å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ç®€å•ç†è§£æ­¤è¿›ç¨‹æ˜¯Serviceçš„é€æ˜ä»£ç†å…¼è´Ÿè½½å‡è¡¡å™¨ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†åˆ°æŸä¸ªServiceçš„è®¿é—®è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¤šä¸ªPodå®ä¾‹ä¸Šï¼Œè€Œkube-proxyåº•å±‚åˆæ˜¯é€šè¿‡iptableså’Œipvså®ç°çš„</p>
<h3 id="iptables-æ¨¡å¼">iptables æ¨¡å¼</h3>
<p>iptables æ˜¯ä¸€ä¸ª Linux å†…æ ¸åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„é˜²ç«å¢™ï¼Œå¹¶æä¾›äº†å¤§é‡çš„æ•°æ®åŒ…å¤„ç†å’Œè¿‡æ»¤æ–¹é¢çš„èƒ½åŠ›ã€‚å®ƒå¯ä»¥åœ¨æ ¸å¿ƒæ•°æ®åŒ…å¤„ç†ç®¡çº¿ä¸Šç”¨ Hook æŒ‚æ¥ä¸€ç³»åˆ—çš„è§„åˆ™ã€‚iptables æ¨¡å¼ä¸­ kube-proxy åœ¨ <code>NAT pre-routing</code> Hook ä¸­å®ç°å®ƒçš„ NAT å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚è¿™ç§æ–¹æ³•ç®€å•æœ‰æ•ˆï¼Œä¾èµ–äºæˆç†Ÿçš„å†…æ ¸åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿå’Œå…¶å®ƒè·Ÿ iptables åä½œçš„åº”ç”¨ï¼ˆä¾‹å¦‚ Calicoï¼‰èæ´½ç›¸å¤„ã€‚</p>
<p>ç„¶è€Œ kube-proxy çš„ç”¨æ³•æ˜¯ä¸€ç§ O(n) ç®—æ³•ï¼Œå…¶ä¸­çš„ n éšé›†ç¾¤è§„æ¨¡åŒæ­¥å¢é•¿ï¼Œè¿™é‡Œçš„é›†ç¾¤è§„æ¨¡ï¼Œæ›´æ˜ç¡®çš„è¯´å°±æ˜¯æœåŠ¡å’Œåç«¯ Pod çš„æ•°é‡ã€‚</p>
<h3 id="ipvs-æ¨¡å¼">ipvs æ¨¡å¼</h3>
<p>IPVS æ˜¯ä¸€ä¸ªç”¨äºè´Ÿè½½å‡è¡¡çš„ Linux å†…æ ¸åŠŸèƒ½ã€‚IPVS æ¨¡å¼ä¸‹ï¼Œkube-proxy ä½¿ç”¨ IPVS è´Ÿè½½å‡è¡¡ä»£æ›¿äº† iptableã€‚è¿™ç§æ¨¡å¼åŒæ ·æœ‰æ•ˆï¼ŒIPVS çš„è®¾è®¡å°±æ˜¯ç”¨æ¥ä¸ºå¤§é‡æœåŠ¡è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ï¼Œå®ƒæœ‰ä¸€å¥—ä¼˜åŒ–è¿‡çš„ APIï¼Œä½¿ç”¨ä¼˜åŒ–çš„æŸ¥æ‰¾ç®—æ³•ï¼Œè€Œä¸æ˜¯ç®€å•çš„ä»åˆ—è¡¨ä¸­æŸ¥æ‰¾è§„åˆ™ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œkube-proxy åœ¨ IPVS æ¨¡å¼ä¸‹ï¼Œå…¶è¿æ¥è¿‡ç¨‹çš„å¤æ‚åº¦ä¸º O(1)ã€‚æ¢å¥è¯è¯´ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œä»–çš„è¿æ¥å¤„ç†æ•ˆç‡æ˜¯å’Œé›†ç¾¤è§„æ¨¡æ— å…³çš„ã€‚</p>
<p>å¦å¤–ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„<a class="link" href="https://cloud.tencent.com/product/clb?from=10680"  target="_blank" rel="noopener"
    >è´Ÿè½½å‡è¡¡å™¨</a>ï¼ŒIPVS åŒ…å«äº†å¤šç§ä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä¾‹å¦‚è½®è¯¢ã€æœ€çŸ­æœŸæœ›å»¶è¿Ÿã€æœ€å°‘è¿æ¥ä»¥åŠå„ç§å“ˆå¸Œæ–¹æ³•ç­‰ã€‚è€Œ iptables å°±åªæœ‰ä¸€ç§éšæœºå¹³ç­‰çš„é€‰æ‹©ç®—æ³•ã€‚</p>
<p>IPVS çš„ä¸€ä¸ªæ½œåœ¨ç¼ºç‚¹å°±æ˜¯ï¼ŒIPVS å¤„ç†æ•°æ®åŒ…çš„è·¯å¾„å’Œé€šå¸¸æƒ…å†µä¸‹ iptables è¿‡æ»¤å™¨çš„è·¯å¾„æ˜¯ä¸åŒçš„ã€‚å¦‚æœè®¡åˆ’åœ¨æœ‰å…¶ä»–ç¨‹åºä½¿ç”¨ iptables çš„ç¯å¢ƒä¸­ä½¿ç”¨ IPVSï¼Œéœ€è¦è¿›è¡Œä¸€äº›ç ”ç©¶ï¼Œçœ‹çœ‹ä»–ä»¬æ˜¯å¦èƒ½å¤Ÿåè°ƒå·¥ä½œã€‚ï¼ˆCalico å·²ç»å’Œ IPVS kube-proxy å…¼å®¹ï¼‰</p>
<h3 id="kube-proxy-ipvså’Œiptablesçš„å¼‚åŒ">kube-proxy ipvså’Œiptablesçš„å¼‚åŒ</h3>
<p>iptablesä¸IPVSéƒ½æ˜¯åŸºäºNetfilterå®ç°çš„ï¼Œä½†å› ä¸ºå®šä½ä¸åŒï¼ŒäºŒè€…æœ‰ç€æœ¬è´¨çš„å·®åˆ«ï¼šiptablesæ˜¯ä¸ºé˜²ç«å¢™è€Œè®¾è®¡çš„ï¼›IPVSåˆ™ä¸“é—¨ç”¨äºé«˜æ€§èƒ½è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆHashè¡¨ï¼‰ï¼Œå…è®¸å‡ ä¹æ— é™çš„è§„æ¨¡æ‰©å¼ ã€‚</p>
<p>ä¸iptablesç›¸æ¯”ï¼ŒIPVSæ‹¥æœ‰ä»¥ä¸‹æ˜æ˜¾ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä¸ºå¤§å‹é›†ç¾¤æä¾›äº†æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ï¼›</li>
<li>æ”¯æŒæ¯”iptablesæ›´å¤æ‚çš„å¤åˆ¶å‡è¡¡ç®—æ³•ï¼ˆæœ€å°è´Ÿè½½ã€æœ€å°‘è¿æ¥ã€åŠ æƒç­‰ï¼‰ï¼›</li>
<li>æ”¯æŒæœåŠ¡å™¨å¥åº·æ£€æŸ¥å’Œè¿æ¥é‡è¯•ç­‰åŠŸèƒ½ï¼›</li>
<li>å¯ä»¥åŠ¨æ€ä¿®æ”¹ipsetçš„é›†åˆï¼Œå³ä½¿iptablesçš„è§„åˆ™æ­£åœ¨ä½¿ç”¨è¿™ä¸ªé›†åˆã€‚</li>
</ul>
<h1 id="service">Service</h1>
<p>NodePort</p>
<p>LoadBalancer</p>
<h1 id="7-calico-bgp-vrf">7 Calico BGP VRF</h1>
<p><a class="link" href="https://www.cnblogs.com/linwenye/p/13269871.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/linwenye/p/13269871.html</a></p>
<p><a class="link" href="https://larioy.gst.monster/2021/09/05/k8s-ji-chong-cni-fang-an-jie-xi/calico/ensp-mo-ni-calico-kua-wang-duan-bgp-wang-luo/"  target="_blank" rel="noopener"
    >https://larioy.gst.monster/2021/09/05/k8s-ji-chong-cni-fang-an-jie-xi/calico/ensp-mo-ni-calico-kua-wang-duan-bgp-wang-luo/</a></p>
<p><a class="link" href="https://www.cnblogs.com/Cylon/p/14399682.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/Cylon/p/14399682.html</a></p>
<p><strong>Full-mesh</strong></p>
<p>å…¨äº’è”æ¨¡å¼ï¼Œå¯ç”¨äº† BGP ä¹‹åï¼ŒCalico çš„é»˜è®¤è¡Œä¸ºæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹å½¼æ­¤å¯¹ç­‰çš„æƒ…å†µä¸‹åˆ›å»ºå®Œæ•´çš„å†…éƒ¨ BGPï¼ˆiBGPï¼‰è¿æ¥ï¼Œè¿™ä½¿ Calico å¯ä»¥åœ¨ä»»ä½• L2 ç½‘ç»œï¼ˆæ— è®ºæ˜¯å…¬æœ‰äº‘è¿˜æ˜¯ç§æœ‰äº‘ï¼‰ä¸Šè¿è¡Œï¼Œæˆ–è€…è¯´ï¼ˆå¦‚æœé…äº† IPIPï¼‰å¯ä»¥åœ¨ä»»ä½•ä¸ç¦æ­¢ IPIP æµé‡çš„ç½‘ç»œä¸Šä½œä¸º overlay è¿è¡Œã€‚å¯¹äº vxlan overlayï¼ŒCalico ä¸ä½¿ç”¨ BGPã€‚</p>
<p>Full-mesh æ¨¡å¼å¯¹äº 100 ä¸ªä»¥å†…çš„å·¥ä½œèŠ‚ç‚¹æˆ–æ›´å°‘èŠ‚ç‚¹çš„ä¸­å°è§„æ¨¡éƒ¨ç½²éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯åœ¨è¾ƒå¤§çš„è§„æ¨¡ä¸Šï¼ŒFull-mesh æ¨¡å¼æ•ˆç‡ä¼šé™ä½ï¼Œè¾ƒå¤§è§„æ¨¡æƒ…å†µä¸‹ï¼ŒCalico å®˜æ–¹å»ºè®®ä½¿ç”¨ Route reflectors</p>
<p><strong>Route reflectors</strong></p>
<p>å¦‚æœæƒ³æ„å»ºå†…éƒ¨ BGPï¼ˆiBGPï¼‰å¤§è§„æ¨¡é›†ç¾¤ï¼Œå¯ä»¥ä½¿ç”¨ BGP è·¯ç”±åå°„å™¨æ¥å‡å°‘æ¯ä¸ªèŠ‚ç‚¹ä¸Šä½¿ç”¨ BGP å¯¹ç­‰ä½“çš„æ•°é‡ã€‚åœ¨æ­¤æ¨¡å‹ä¸­ï¼ŒæŸäº›èŠ‚ç‚¹å……å½“è·¯ç”±åå°„å™¨ï¼Œå¹¶é…ç½®ä¸ºåœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹å®Œæ•´çš„ç½‘æ ¼ã€‚ç„¶åï¼Œå°†å…¶ä»–èŠ‚ç‚¹é…ç½®ä¸ºä¸è¿™äº›è·¯ç”±åå°„å™¨çš„å­é›†ï¼ˆé€šå¸¸ä¸ºå†—ä½™ï¼Œé€šå¸¸ä¸º 2 ä¸ªï¼‰è¿›è¡Œå¯¹ç­‰ï¼Œä»è€Œä¸å…¨ç½‘æ ¼ç›¸æ¯”å‡å°‘äº† BGP å¯¹ç­‰è¿æ¥çš„æ€»æ•°ã€‚</p>
<p><strong>Top of Rack (ToR)</strong></p>
<p>åœ¨æœ¬åœ°éƒ¨ç½²ä¸­ï¼Œå¯ä»¥å°† Calico é…ç½®ä¸ºç›´æ¥ä¸ç‰©ç†ç½‘ç»œåŸºç¡€ç»“æ„å¯¹ç­‰ã€‚é€šå¸¸ï¼Œè¿™éœ€è¦æ¶‰åŠåˆ°ç¦ç”¨ Calico çš„é»˜è®¤ Full-mesh è¡Œä¸ºï¼Œå°†æ‰€æœ‰ Calico èŠ‚ç‚¹ä¸ L3 ToR è·¯ç”±å™¨å¯¹ç­‰ã€‚</p>
<h2 id="spine--leaf--rr">spine  Leaf  RR</h2>
<p>æœ€è¿‘æˆ‘å¸ä¸šåŠ¡æ‰©å±•åœ¨æœºæˆ¿æ–°å¼€äº†ä¸€ä¸ªåŒºåŸŸï¼ŒæŠ˜è…¾äº†ä¸€æ®µæ—¶é—´çš„ Calico BGPï¼Œä¸ºäº†èƒ½å°†æ•´ä¸ªè¿‡ç¨‹æ¢³ç†å¾—æ›´ç®€å•æ˜äº†ï¼Œæˆ‘è¿˜æ˜¯å†³å®šå°†è¿™ä¸ªè¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚ä¸ç®¡æ˜¯å¯¹å½“ä¸‹çš„æ€»ç»“è¿˜æ˜¯æœªæ¥é‡æ–°å®¡è§†æ–¹æ¡ˆéƒ½æ˜¯å€¼å¾—çš„ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œäº‘åŸç”Ÿä¸‹çš„ç½‘ç»œæ¶æ„åœ¨ Kubernetes é‡Œå¯ä»¥ç®—æ˜¯ç™¾èŠ±é½æ”¾ï¼Œå„æœ‰æ‰€é•¿ï¼Œè¿™æ— å½¢ä¸­ä¹Ÿå¯¼è‡´ç½‘ç»œå§‹ç»ˆæ˜¯æ¨ªåœ¨å¹¿å¤§ K8S çˆ±å¥½è€…é¢å‰è¿ˆå‘é«˜é˜¶ç®¡ç†çš„å‡ åº§å¤§å±±ä¹‹ä¸€ã€‚é€šå¸¸å¤§å®¶åœ¨å…¬æœ‰äº‘ä¸Šä½¿ç”¨å‚å®¶æä¾›çš„ CNI ç»„ä»¶å¯èƒ½è¿˜æ„Ÿå—ä¸åˆ°å…¶å¤æ‚ï¼Œä½†ä¸€æ—¦è¦åœ¨ IDC è‡ªå»ºé›†ç¾¤æ—¶ï¼Œå°±ä¼šé¢ä¸´ Kubernetes ç½‘ç»œæ¶æ„é€‰å‹çš„é—®é¢˜ã€‚ Calico ä½œä¸ºç›®å‰ Kubernetes ä¸Šç”¨é€”æœ€å¹¿çš„ Kubernetes CNI ä¹‹ä¸€ï¼Œè‡ªç„¶ä¹Ÿæœ‰å¾ˆå¤šè¿½éšè€…ã€‚è€Œæœ¬ç¯‡ä¾¿æ˜¯åœ¨è‡ªå»ºæœºæˆ¿å†… BGP ç»„ç½‘ä¸‹çš„ä¸€æ¬¡æ€»ç»“ã€‚</p>
<h2 id="å…³äº-cni-é€‰å‹">å…³äº CNI é€‰å‹</h2>
<p>äº‘åŸç”Ÿ CNI ç»„ä»¶è¿™ä¹ˆå¤šï¼Œè¯¸å¦‚è€ç‰Œçš„ Flannelã€Calicoã€WeaveNetã€Kube-Router ä»¥åŠè¿‘ä¸¤å¹´å…´èµ·çš„ Antreaã€ Kube-OVN å’Œ Ciliumã€‚å®ƒä»¬éƒ½åœ¨å„è‡ªçš„åœºæ™¯ä¸‹å„æœ‰æ‰€é•¿ï¼Œåœ¨é€‰æ‹©å‰æˆ‘ä»¬å¯ä»¥å…ˆå¯¹å…¶åšä¸€ä¸ªç®€å•çš„åŠŸèƒ½æ€§çš„æ¯”è¾ƒ:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Flannel</th>
<th>Calico</th>
<th>Cilium</th>
<th>WeaveNet</th>
<th>Antrea</th>
<th>Kube-OVN</th>
</tr>
</thead>
<tbody>
<tr>
<td>éƒ¨ç½²æ¨¡å¼</td>
<td>DaemonSet</td>
<td>DaemonSet</td>
<td>DaemonSet</td>
<td>DaemonSet</td>
<td>DaemonSet</td>
<td>DaemonSet</td>
</tr>
<tr>
<td>åŒ…å°è£…ä¸è·¯ç”±</td>
<td>VxLAN</td>
<td>IPinIP,BGP,eBPF</td>
<td>VxLAN,eBPF</td>
<td>VxLAN</td>
<td>Vxlan</td>
<td>Vlan/Geneve/BGP</td>
</tr>
<tr>
<td>ç½‘ç»œç­–ç•¥</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>å­˜å‚¨å¼•æ“</td>
<td>Etcd</td>
<td>Etcd</td>
<td>Etcd</td>
<td>No</td>
<td>Etcd</td>
<td>Etcd</td>
</tr>
<tr>
<td>ä¼ è¾“åŠ å¯†</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>è¿è¥æ¨¡å¼</td>
<td>ç¤¾åŒº</td>
<td>Tigera</td>
<td>ç¤¾åŒº</td>
<td>WeaveWorks</td>
<td>VMware</td>
<td>çµé›€äº‘</td>
</tr>
</tbody>
</table></div>
<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-calico">ä¸ºä»€ä¹ˆé€‰æ‹© Calico</h2>
<p>åœ¨å¯¹æˆ‘å¸æœºæˆ¿æ–°åŒºåŸŸçš„ç½‘ç»œé€‰å‹ä¸Šï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Calico ä½œä¸ºäº‘ç«¯ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç®€å•é˜è¿°ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹© Calico çš„å‡ ç‚¹åŸå› ï¼š</p>
<ul>
<li>æ”¯æŒ BGP å¹¿æ’­ï¼ŒCalico é€šè¿‡ BGP åè®®å¹¿æ’­è·¯ç”±ä¿¡æ¯ï¼Œä¸”æ¶æ„éå¸¸ç®€å•ã€‚åœ¨ kubernetes å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç° mesh to mesh æˆ–è€… RR æ¨¡å¼ï¼Œåœ¨åæœŸå¦‚æœè¦å®ç°å®¹å™¨è·¨é›†ç¾¤ç½‘ç»œé€šä¿¡æ—¶ï¼Œå®ç°ä¹Ÿå¾ˆå®¹æ˜“ã€‚</li>
<li>Calicoé…ç½®ç®€å•ï¼Œä¸”é…ç½®éƒ½æ˜¯é€šè¿‡ Kubernetes ä¸­çš„ CRD æ¥è¿›è¡Œé›†ä¸­å¼çš„ç®¡ç†ï¼Œé€šè¿‡æ“ä½œ CR èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹é›†ç¾¤å†…çš„å®¹å™¨è¿›è¡Œç»„ç½‘å’Œé…ç½®çš„å®æ—¶å˜æ›´</li>
<li>ä¸°å¯Œçš„åŠŸèƒ½åŠå…¶å…¼å®¹æ€§ï¼Œè€ƒè™‘åˆ°é›†ç¾¤å†…éœ€è¦ä¸ä¸‰æ–¹åº”ç”¨å…¼å®¹ï¼Œä¾‹å¦‚é…ç½®å¤šç§Ÿæˆ·ç½‘ç»œã€å›ºå®šå®¹å™¨ IP ã€ç½‘ç»œç­–ç•¥ç­‰åŠŸèƒ½åˆæˆ–è€…ä¸ Istioã€MetalLBã€Cilium ç­‰ç»„ä»¶çš„å…¼å®¹ï¼ŒCalico çš„çš„è¡¨ç°éƒ½éå¸¸ä¸é”™</li>
<li>é«˜æ€§èƒ½ï¼Œ Calico çš„æ•°æ®é¢é‡‡ç”¨ HostGW çš„æ–¹å¼ï¼Œç”±äºæ˜¯ä¸€ä¸ªçº¯ä¸‰æ–¹çš„æ•°æ®é€šä¿¡ï¼Œæ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ä¸‹æ€§èƒ½å’Œä¸»æœºèµ„æºå ç”¨æ–¹é¢ä¸ä¼šå¤ªå·®ï¼Œè‡³å°‘ä¹Ÿèƒ½æ’åœ¨ç¬¬ä¸€æ¢¯é˜Ÿ</li>
</ul>
<p>ç»“åˆæˆ‘å¸æœºæˆ¿æ–°åŒºåŸŸé‡‡è´­çš„æ˜¯ H3C S9 ç³»åˆ—çš„äº¤æ¢æœºï¼Œæ”¯æŒç›´æ¥åœ¨æ¥å…¥å±‚çš„äº¤æ¢æœºä¾§å¼€å¯è·¯ç”±åå°„å™¨ã€‚æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©Calico å¹¶ä»¥ BGP RR çš„æ¨¡å¼ä½œä¸º Kubernetes çš„ CNI ç»„ä»¶ä¾¿æ°´åˆ°æ¸ æˆã€‚</p>
<h2 id="å…³äº-metallb">å…³äº MetalLB</h2>
<p>åœ¨è®² MetalLB ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸‹åº”ç”¨éƒ¨ç½²åœ¨ Kubernetes ä¸­ï¼Œå®ƒçš„ä¸‹æ¸¸æœåŠ¡æ˜¯å¦‚ä½•è®¿é—®çš„å§ã€‚é€šå¸¸æœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µ</p>
<ul>
<li>é›†ç¾¤å†…è¯·æ±‚:</li>
</ul>
<p>ç›´æ¥é€šè¿‡ Kubernetes çš„ Service è®¿é—®åº”ç”¨ã€‚</p>
<ul>
<li>é›†ç¾¤å¤–è¯·æ±‚ï¼š</li>
</ul>
<ol>
<li>é€šè¿‡ NodePort åœ¨ä¸»æœºä¸Šä»¥ nat æ–¹å¼å°†æµé‡è½¬å‘ç»™å®¹å™¨ï¼Œä¼˜ç‚¹é…ç½®ç®€å•ä¸”èƒ½æä¾›ç®€å•çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œ ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ä¸‹æ¸¸åº”ç”¨åªèƒ½é€šè¿‡ä¸»æœºåœ°å€+ç«¯å£æ¥åšå¯»å€</li>
<li>é€šè¿‡ Ingress-nginx åšåº”ç”¨å±‚çš„ 7 å±‚è½¬å‘ï¼Œä¼˜ç‚¹æ˜¯è·¯ç”±è§„åˆ™çµæ´»ï¼Œä¸”æµé‡åªç»è¿‡ä¸€å±‚ä»£ç†ä¾¿ç›´è¾¾å®¹å™¨ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚ç¼ºç‚¹æ˜¯ ingress-nginx æœ¬èº«çš„æœåŠ¡è¿˜æ˜¯éœ€è¦é€šè¿‡ NodePort æˆ–è€… HostNetwork æ¥æ”¯æŒ</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°åœ¨æ²¡æœ‰å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„å¼•å…¥ä¹‹å‰ï¼Œåº”ç”¨éƒ¨ç½²åœ¨ kubernetes é›†ç¾¤å†…ï¼Œå®ƒå¯¹å—åŒ—å‘æµé‡çš„åœ°å€å¯»å€ä»ç„¶ä¸å¤ªå‹å¥½ã€‚ä¹Ÿè®¸æœ‰çš„åŒå­¦å°±è¯´äº†ï¼Œæˆ‘åœ¨å…¬æœ‰äº‘ä¸Šä½¿ç”¨ Kubernetes æ—¶ï¼Œå°† Service ç±»å‹è®¾ç½®æˆ LoadBalancerï¼Œé›†ç¾¤å°±èƒ½è‡ªåŠ¨ä¸ºæˆ‘çš„åº”ç”¨åˆ›å»ºä¸€æ¡å¸¦è´Ÿè½½å‡è¡¡å™¨åœ°å€çš„ IPä¾›å¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬è‡ªå·±éƒ¨ç½²çš„ Kubernetes é›†ç¾¤æœ‰æ²¡æœ‰ç±»ä¼¼çš„ä¸œè¥¿æ¥å®ç°å‘¢ï¼Ÿ</p>
<p>å½“ç„¶æœ‰ï¼MetalLB å°±æ˜¯åœ¨è£¸é‡‘å±æœåŠ¡å™¨ä¸‹ä¸º Kubernetes é›†ç¾¤è¯ç”Ÿçš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨é¡¹ç›®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">äº‹å®ä¸Šå½“ç„¶ä¸æ­¢ MetalLBï¼Œå¼€æºç•Œé‡Œé¢è¿˜æœ‰å…¶ä»–è¯¸å¦‚PureLBã€OpenELBç­‰è´Ÿè½½å‡è¡¡äº§å“ã€‚ä¸è¿‡æœ¬æ–‡æ—¨åœ¨é‡‡ç”¨ BGP åè®®æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥é‡ç‚¹ä¼šåå‘ MetelLB
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•æ¥è¯´ï¼ŒMetalLBåŒ…å«äº†ä¸¤ä¸ªç»„ä»¶ï¼ŒControlerç”¨äºæ“ä½œ Service èµ„æºçš„å˜æ›´ä»¥åŠIPAMã€‚Speakerç”¨äºå¤–å¹¿æ’­åœ°å€ä»¥åŠ BGP çš„è¿æ¥ã€‚å®ƒæ”¯æŒä¸¤ç§æµæ¨¡å¼æ¨¡å¼å³ï¼šlayer2 å’Œ BGPã€‚</p>
<ul>
<li>Layer2 æ¨¡å¼</li>
</ul>
<p>åˆå«ARP/NDPæ¨¡å¼ï¼Œåœ¨æ­¤æ¨¡å¼ä¸‹ï¼ŒKubenretesé›†ç¾¤ä¸­è¿è¡Œ Speaker çš„ä¸€å°æœºå™¨é€šè¿‡ leader é€‰ä¸¾ï¼Œè·å– Service çš„ LoadBalancer IP çš„æ‰€æœ‰æƒï¼Œå¹¶ä½¿ç”¨ ARP åè®®å°†å…¶ IP å’Œ MAC å¹¿æ’­å‡ºå»ï¼Œä»¥ä½¿è¿™äº› IP èƒ½å¤Ÿåœ¨æœ¬åœ°ç½‘ç»œä¸Šå¯è®¿é—®ã€‚ç”±æ­¤å¯è§ï¼Œä½¿ç”¨ Layer2 çš„æ¨¡å¼å¯¹ç°æœ‰ç½‘ç»œå¹¶æ²¡æœ‰å¤ªå¤šçš„è¦æ±‚ï¼Œç”šè‡³ä¸éœ€è¦è·¯ç”±å™¨çš„æ”¯æŒã€‚ä¸è¿‡ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼ŒLoadBalancer IP æ‰€åœ¨çš„ Node èŠ‚ç‚¹æ‰¿è½½äº†æ‰€æœ‰çš„æµé‡ï¼Œä¼šäº§ç”Ÿä¸€å®šçš„ç½‘ç»œç“¶é¢ˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å°† Layer2 æ¨¡å¼ç†è§£ä¸ºä¸ Keepalived åŸç†ç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…ä¸º Layer2 çš„lead é€‰ä¸¾å¹¶ä¸æ˜¯ä½¿ç”¨ VRRP ç»„æ’­æ¥é€šä¿¡çš„
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>BGP æ¨¡å¼</li>
</ul>
<p>MabelLB åœ¨ BGP æ¨¡å¼ä¸‹ï¼Œé›†ç¾¤ä¸­çš„æ‰€æœ‰è¿è¡Œ Speaker çš„ä¸»æœºéƒ½å°†ä¸ä¸Šå±‚äº¤æ¢æœºå»ºç«‹ä¸€æ¡BGP è¿æ¥ï¼Œå¹¶å¹¿æ’­å…¶ LoadBalancer çš„IP åœ°å€ã€‚ä¼˜ç‚¹æ˜¯çœŸæ­£çš„å®ç°äº†ç½‘ç»œè´Ÿè½½å‡è¡¡ï¼Œç¼ºç‚¹å°±æ˜¯é…ç½®ç›¸å¯¹è€Œè¨€è¦å¤æ‚è®¸å¤šï¼Œä¸”éœ€ä¸Šå±‚è·¯ç”±å™¨æ”¯æŒBGPã€‚</p>
<p>æœ¬æ–‡ä¸»è¦è®²è¿°åœ¨ä¼ ç»Ÿçš„è‡ªå»ºæ•°æ®ä¸­å¿ƒï¼Œåˆ©ç”¨ Calico å’Œ MetalLB æ¥ç»„ä»¶å†…éƒ¨çš„ BGP ç½‘ç»œã€‚å¹¶ä»¥æ­¤æ¥ä¸º Kubernetes æä¾› <code>Pod - Pod</code> ã€<code>Node - Pod</code> å’Œ <code>Node - Loadbalancer</code>ç½‘ç»œäº’è®¿çš„èƒ½åŠ›ã€‚</p>
<h1 id="8-metallblayer2-bgp-vrf">8 Metallb(Layer2 BGP) VRF</h1>
<p><a class="link" href="https://blog.csdn.net/wanger5354/article/details/124964489"  target="_blank" rel="noopener"
    >https://blog.csdn.net/wanger5354/article/details/124964489</a></p>
<p><a class="link" href="https://metallb.universe.tf/configuration/"  target="_blank" rel="noopener"
    >https://metallb.universe.tf/configuration/</a></p>
<h2 id="installation">INSTALLATION</h2>
<p>Before starting with installation, make sure you meet all the <a class="link" href="https://metallb.universe.tf/#requirements"  target="_blank" rel="noopener"
    >requirements</a>. In particular, you should pay attention to <a class="link" href="https://metallb.universe.tf/installation/network-addons/"  target="_blank" rel="noopener"
    >network addon compatibility</a>.</p>
<p>If youâ€™re trying to run MetalLB on a cloud platform, you should also look at the <a class="link" href="https://metallb.universe.tf/installation/clouds/"  target="_blank" rel="noopener"
    >cloud compatibility</a> page and make sure your cloud platform can work with MetalLB (most cannot).</p>
<p>There are three supported ways to install MetalLB: using plain Kubernetes manifests, using Kustomize, or using Helm.</p>
<h3 id="preparation">Preparation</h3>
<p>If youâ€™re using kube-proxy in IPVS mode, since Kubernetes v1.14.2 you have to enable strict ARP mode.</p>
<p><em>Note, you donâ€™t need this if youâ€™re using kube-router as service-proxy because it is enabling strict ARP by default.</em></p>
<p>You can achieve this by editing kube-proxy config in current cluster:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit configmap -n kube-system kube-proxy
</span></span></code></pre></td></tr></table>
</div>
</div><p>and set:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeproxy.config.k8s.io/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeProxyConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ipvs&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ipvs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strictARP</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>You can also add this configuration snippet to your kubeadm-config, just append it with <code>---</code> after the main configuration.</p>
<p>If you are trying to automate this change, these shell snippets may help you:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># see what changes would be made, returns nonzero returncode if different</span>
</span></span><span class="line"><span class="cl">kubectl get configmap kube-proxy -n kube-system -o yaml <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sed -e <span class="s2">&#34;s/strictARP: false/strictARP: true/&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>kubectl diff -f - -n kube-system
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># actually apply the changes, returns nonzero returncode on errors only</span>
</span></span><span class="line"><span class="cl">kubectl get configmap kube-proxy -n kube-system -o yaml <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sed -e <span class="s2">&#34;s/strictARP: false/strictARP: true/&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>kubectl apply -f - -n kube-system
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="installation-by-manifest">Installation By Manifest</h3>
<p>To install MetalLB, apply the manifest:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.4/config/manifests/metallb-native.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you want to deploy MetalLB using the <a class="link" href="https://metallb.universe.tf/configuration/#enabling-bfd-support-for-bgp-sessions"  target="_blank" rel="noopener"
    >experimental FRR mode</a>, apply the manifests:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.4/config/manifests/metallb-frr.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>Please do note that these manifests deploy MetalLB from the main development branch. We highly encourage cloud operators to deploy a stable released version of MetalLB on production environments!</p>
<p>This will deploy MetalLB to your cluster, under the <code>metallb-system</code> namespace. The components in the manifest are:</p>
<ul>
<li>The <code>metallb-system/controller</code> deployment. This is the cluster-wide controller that handles IP address assignments.</li>
<li>The <code>metallb-system/speaker</code> daemonset. This is the component that speaks the protocol(s) of your choice to make the services reachable.</li>
<li>Service accounts for the controller and speaker, along with the RBAC permissions that the components need to function.</li>
</ul>
<p>The installation manifest does not include a configuration file. MetalLBâ€™s components will still start, but will remain idle until you <a class="link" href="https://metallb.universe.tf/configuration/"  target="_blank" rel="noopener"
    >start deploying resources</a>.</p>
<h3 id="installation-with-kustomize">Installation With Kustomize</h3>
<p>You can install MetalLB with <a class="link" href="https://github.com/kubernetes-sigs/kustomize"  target="_blank" rel="noopener"
    >Kustomize</a> by pointing at the remote kustomization file.</p>
<p>In the following example, we are deploying MetalLB with the native bgp implementation :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># kustomization.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">github.com/metallb/metallb/config/native?ref=v0.13.4</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In order to deploy the <a class="link" href="https://metallb.universe.tf/configuration/#enabling-bfd-support-for-bgp-sessions"  target="_blank" rel="noopener"
    >experimental FRR mode</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># kustomization.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">github.com/metallb/metallb/config/frr?ref=v0.13.4</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="installation-with-helm">Installation With Helm</h3>
<p>You can install MetallLB with <a class="link" href="https://helm.sh/"  target="_blank" rel="noopener"
    >Helm</a> by using the Helm chart repository: <code>https://metallb.github.io/metallb</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm repo add metallb https://metallb.github.io/metallb
</span></span><span class="line"><span class="cl">helm install metallb metallb/metallb
</span></span></code></pre></td></tr></table>
</div>
</div><p>A values file may be specified on installation. This is recommended for providing configs in Helm values:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm install metallb metallb/metallb -f values.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>The speaker pod requires elevated permission in order to perform its network functionalities.</p>
<p>If you are using MetalLB with a kubernetes version that enforces <a class="link" href="https://kubernetes.io/docs/concepts/security/pod-security-admission/"  target="_blank" rel="noopener"
    >pod security admission</a> (which is beta in k8s 1.23), the namespace MetalLB is deployed to must be labelled with:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l">privileged</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l">privileged</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l">privileged</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>If you want to deploy MetalLB using the <a class="link" href="https://metallb.universe.tf/configuration/#enabling-bfd-support-for-bgp-sessions"  target="_blank" rel="noopener"
    >experimental FRR mode</a>, the following value must be set:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">speaker</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">frr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-the-metallb-operator">Using The MetalLB Operator</h3>
<p>The MetalLB Operator is available on OperatorHub at <a class="link" href="https://operatorhub.io/operator/metallb-operator"  target="_blank" rel="noopener"
    >operatorhub.io/operator/metallb-operator</a>. It eases the deployment and life-cycle of MetalLB in a cluster and allows configuring MetalLB via CRDs.</p>
<p>If you want to deploy MetalLB using the <a class="link" href="https://metallb.universe.tf/configuration/#enabling-bfd-support-for-bgp-sessions"  target="_blank" rel="noopener"
    >experimental FRR mode</a>, you must edit the ClusterServiceVersion resource named <code>metallb-operator</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit csv metallb-operator
</span></span></code></pre></td></tr></table>
</div>
</div><p>and change the <code>BGP_TYPE</code> environment variable of the <code>manager</code> container to <code>frr</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">METALLB_BGP_TYPE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">frr</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="frr-daemons-logging-level">FRR Daemons Logging Level</h3>
<p>The FRR daemons logging level are configured using the speaker <code>--log-level</code> argument following the below mapping:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">Speaker log level</th>
<th style="text-align:left">FRR log level</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">all, debug</td>
<td style="text-align:left">debugging</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left">informational</td>
</tr>
<tr>
<td style="text-align:left">warn</td>
<td style="text-align:left">warnings</td>
</tr>
<tr>
<td style="text-align:left">error</td>
<td style="text-align:left">error</td>
</tr>
<tr>
<td style="text-align:left">none</td>
<td style="text-align:left">emergencies</td>
</tr>
</tbody>
</table></div>
<p>To override this behavior, you can set the <code>FRR_LOGGING_LEVEL</code> speakerâ€™s environment to any <a class="link" href="https://docs.frrouting.org/en/latest/basic.html#clicmd-log-stdout-LEVEL"  target="_blank" rel="noopener"
    >FRR supported value</a>.</p>
<h3 id="upgrade">Upgrade</h3>
<p>When upgrading MetalLB, always check the <a class="link" href="https://metallb.universe.tf/release-notes/"  target="_blank" rel="noopener"
    >release notes</a> to see the changes and required actions, if any. Pay special attention to the release notes when upgrading to newer major/minor releases.</p>
<p>Unless specified otherwise in the release notes, upgrade MetalLB either using <a class="link" href="https://metallb.universe.tf/installation/#installation-by-manifest"  target="_blank" rel="noopener"
    >plain manifests</a> or using <a class="link" href="https://metallb.universe.tf/installation/#installation-with-kustomize"  target="_blank" rel="noopener"
    >Kustomize</a> as described above.</p>
<p>Please take the known limitations for <a class="link" href="https://metallb.universe.tf/concepts/layer2/#limitations"  target="_blank" rel="noopener"
    >layer2</a> and <a class="link" href="https://metallb.universe.tf/concepts/bgp/#limitations"  target="_blank" rel="noopener"
    >bgp</a> into account when performing an upgrade.</p>
<h3 id="setting-the-loadbalancer-class">Setting The LoadBalancer Class</h3>
<p>MetalLB supports <a class="link" href="https://kubernetes.io/docs/concepts/services-networking/service/#load-balancer-class"  target="_blank" rel="noopener"
    >LoadBalancerClass</a>, which allows multiple load balancer implementations to co-exist. In order to set the loadbalancer class MetalLB should be listening for, the <code>--lb-class=&lt;CLASS_NAME&gt;</code> parameter must be provided to both the speaker and the controller.</p>
<p>The helm charts support it via the <code>loadBalancerClass</code> parameter.</p>
<h2 id="configuration">CONFIGURATION</h2>
<p>MetalLB remains idle until configured. This is accomplished by creating and deploying various resources into <strong>the same namespace</strong> (metallb-system) MetalLB is deployed into.</p>
<p>There are various examples of the configuration CRs in <a class="link" href="https://raw.githubusercontent.com/metallb/metallb/v0.13.4/configsamples"  target="_blank" rel="noopener"
    ><code>configsamples</code></a>.</p>
<p>Also, the API is <a class="link" href="https://metallb.universe.tf/apis/_index.md"  target="_blank" rel="noopener"
    >fully documented here</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">If you installed MetalLB with Helm, you will need to change the namespace of the CRs to match the namespace in which MetalLB was deployed.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="defining-the-ips-to-assign-to-the-load-balancer-services">Defining The IPs To Assign To The Load Balancer Services</h3>
<p>In order to assign an IP to the services, MetalLB must be instructed to do so via the <code>IPAddressPool</code> CR.</p>
<p>All the IPs allocated via <code>IPAddressPool</code>s contribute to the pool of IPs that MetalLB uses to assign IPs to services.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">IPAddressPool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">first-pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="m">192.168.10.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="m">192.168.9.1-192.168.9.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">fc00:f853:0ccd:e799::/124</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Multiple instances of <code>IPAddressPool</code>s can co-exist and addresses can be defined by CIDR, by range, and both IPV4 and IPV6 addresses can be assigned.</p>
<h3 id="announce-the-service-ips">Announce The Service IPs</h3>
<p>Once the IPs are assigned to a service, they must be announced.</p>
<p>The specific configuration depends on the protocol(s) you want to use to announce service IPs. Jump to:</p>
<ul>
<li><a class="link" href="https://metallb.universe.tf/configuration/#layer-2-configuration"  target="_blank" rel="noopener"
    >Layer 2 configuration</a></li>
<li><a class="link" href="https://metallb.universe.tf/configuration/#bgp-configuration"  target="_blank" rel="noopener"
    >BGP configuration</a></li>
<li><a class="link" href="https://metallb.universe.tf/configuration/_advanced_bgp_configuration"  target="_blank" rel="noopener"
    >Advanced BGP configuration</a></li>
<li><a class="link" href="https://metallb.universe.tf/configuration/_advanced_l2_configuration"  target="_blank" rel="noopener"
    >Advanced L2 configuration</a></li>
<li><a class="link" href="https://metallb.universe.tf/configuration/_advanced_ipaddresspool_config/"  target="_blank" rel="noopener"
    >Advanced IPAddressPool configuration</a></li>
</ul>
<p>Note: it is possible to announce the same service both via L2 and via BGP (see the relative <a class="link" href="https://metallb.universe.tf/faq/_index.md"  target="_blank" rel="noopener"
    >FAQ</a>).</p>
<h3 id="layer-2-configuration">Layer 2 Configuration</h3>
<p>Layer 2 mode is the simplest to configure: in many cases, you donâ€™t need any protocol-specific configuration, only IP addresses.</p>
<p>Layer 2 mode does not require the IPs to be bound to the network interfaces of your worker nodes. It works by responding to ARP requests on your local network directly, to give the machineâ€™s MAC address to clients.</p>
<p>In order to advertise the IP coming from an <code>IPAddressPool</code>, an <code>L2Advertisement</code> instance must be associated to the <code>IPAddressPool</code>.</p>
<p>For example, the following configuration gives MetalLB control over IPs from <code>192.168.1.240</code> to <code>192.168.1.250</code>, and configures Layer 2 mode:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">IPAddressPool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">first-pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="m">192.168.1.240-192.168.1.250</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">L2Advertisement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Setting no <code>IPAddressPool</code> selector in an <code>L2Advertisement</code> instance is interpreted as that instance being associated to all the <code>IPAddressPool</code>s available.</p>
<p>So in case there are specialized <code>IPAddressPool</code>s, and only some of them must be advertised via L2, the list of <code>IPAddressPool</code>s we want to advertise the IPs from must be declared (alternative, a label selector can be used).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">L2Advertisement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ipAddressPools</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">first-pool</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bgp-configuration">BGP Configuration</h3>
<p>MetalLB needs to be instructed on how to establish a session with one or more external BGP routers.</p>
<p>In order to do so, an instance of <code>BGPPeer</code> must be created for each router we want metallb to connect to.</p>
<p>For a basic configuration featuring one BGP router and one IP address range, you need 4 pieces of information:</p>
<ul>
<li>The router IP address that MetalLB should connect to,</li>
<li>The routerâ€™s AS number,</li>
<li>The AS number MetalLB should use,</li>
<li>An IP address range expressed as a CIDR prefix.</li>
</ul>
<p>As an example if you want to give MetalLB AS number 64500, and connect it to a router at 10.0.0.1 with AS number 64501, your configuration will look like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">BGPPeer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">sample</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">myASN</span><span class="p">:</span><span class="w"> </span><span class="m">64500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">peerASN</span><span class="p">:</span><span class="w"> </span><span class="m">64501</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">peerAddress</span><span class="p">:</span><span class="w"> </span><span class="m">10.0.0.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Given an <code>IPAddressPool</code> like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">IPAddressPool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">first-pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="m">192.168.1.240-192.168.1.250</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>MetalLB must be configured to advertise the IPs coming from it via BGP.</p>
<p>This is done via the <code>BGPAdvertisement</code> CR.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">BGPAdvertisement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Setting no <code>IPAddressPool</code> selector in a <code>BGPAdvertisement</code> instance is interpreted as that instance being associated to all the <code>IPAddressPool</code>s available.</p>
<p>So in case there are specialized <code>AddressPool</code>s, and only some of them must be advertised via BGP, the list of <code>ipAddressPool</code>s we want to advertise the IPs from must be declared (alternative, a label selector can be used).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">BGPAdvertisement</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ipAddressPools</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">first-pool</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="enabling-bfd-support-for-bgp-sessions">Enabling BFD support for BGP sessions</h4>
<p>With the experimental FRR mode, BGP sessions can be backed up by BFD sessions in order to provide a quicker path failure detection than BGP alone provides.</p>
<p>In order to enable BFD, a BFD profile must be added and referenced by a given peer:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">BFDProfile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">testbfdprofile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">receiveInterval</span><span class="p">:</span><span class="w"> </span><span class="m">380</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">transmitInterval</span><span class="p">:</span><span class="w"> </span><span class="m">270</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">metallb.io/v1beta2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">BGPPeer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">peersample</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">metallb-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">myASN</span><span class="p">:</span><span class="w"> </span><span class="m">64512</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">peerASN</span><span class="p">:</span><span class="w"> </span><span class="m">64512</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">peerAddress</span><span class="p">:</span><span class="w"> </span><span class="m">172.30.0.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">bfdProfile</span><span class="p">:</span><span class="w"> </span><span class="l">testbfdprofile</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configuration-validation">Configuration Validation</h3>
<p>MetalLB ships validation webhooks that check the validity of the CRs applied.</p>
<p>However, due to the fact that the global MetalLB configuration is composed by different pieces, not all of the invalid configurations are blocked by those webhooks. Because of that, if a non valid MetalLB configuration is applied, MetalLB discards it and keeps using the last valid configuration.</p>
<p>In future releases MetalLB will expose misconfigurations as part of Kubernetes resources, but currently the only way to understand why the configuration was not loaded is by checking the controllerâ€™s logs.</p>
<h1 id="6-cri-oå®¹å™¨æŸ¥çœ‹">6. cri-oå®¹å™¨æŸ¥çœ‹</h1>
<ul>
<li>å‘Šè­¦æ¶ˆé™¤ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">crictl config runtime-endpoint unix:///run/containerd/containerd.sock
</span></span><span class="line"><span class="cl">crictl config image-endpoint unix:///run/containerd/containerd.sock
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®¹å™¨æŸ¥çœ‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="na">[root@master ~]# crictl ps -a</span>
</span></span><span class="line"><span class="cl"><span class="na">CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID</span>
</span></span><span class="line"><span class="cl"><span class="na">05bf0b07de6d2       85c4a186478c5       27 minutes ago      Running             cni-server                1                   4e02c14191216</span>
</span></span><span class="line"><span class="cl"><span class="na">dc44549c2fb1c       85c4a186478c5       27 minutes ago      Running             kube-ovn-monitor          1                   af7f061cc99da</span>
</span></span><span class="line"><span class="cl"><span class="na">baecb15218ce4       7ecf17eb27602       27 minutes ago      Running             kube-rbac-proxy           1                   5b4a069503baa</span>
</span></span><span class="line"><span class="cl"><span class="na">ba5e1dfb820d2       1dbe0e9319764       27 minutes ago      Running             node-exporter             1                   5b4a069503baa</span>
</span></span><span class="line"><span class="cl"><span class="na">076ee4abc2236       2ae1ba6417cbc       27 minutes ago      Running             kube-proxy                1                   fcdec13137e9c</span>
</span></span><span class="line"><span class="cl"><span class="na">e9694c055e958       85c4a186478c5       27 minutes ago      Running             ovn-central               1                   6e97a806daa56</span>
</span></span><span class="line"><span class="cl"><span class="na">87f8bf7b461ee       85c4a186478c5       27 minutes ago      Running             openvswitch               1                   090c5b465fdfd</span>
</span></span><span class="line"><span class="cl"><span class="na">3947ea767ae98       85c4a186478c5       27 minutes ago      Exited              install-cni               1                   4e02c14191216</span>
</span></span><span class="line"><span class="cl"><span class="na">dedd5885b4364       d521dd763e2e3       27 minutes ago      Running             kube-apiserver            3                   52fe731b64d15</span>
</span></span><span class="line"><span class="cl"><span class="na">93ecf96257381       aebe758cef4cd       27 minutes ago      Running             etcd                      3                   f8fb9d0fddf59</span>
</span></span><span class="line"><span class="cl"><span class="na">189c8028b1b5f       586c112956dfc       27 minutes ago      Running             kube-controller-manager   3                   0cead8b71f125</span>
</span></span><span class="line"><span class="cl"><span class="na">da982f9d8504e       3a5aa3a515f5d       27 minutes ago      Running             kube-scheduler            4                   697f03b8343df</span>
</span></span><span class="line"><span class="cl"><span class="na">7795018ed9846       7ecf17eb27602       7 hours ago         Exited              kube-rbac-proxy           0                   eb7bbd6b1a3ae</span>
</span></span><span class="line"><span class="cl"><span class="na">52c6309afc865       1dbe0e9319764       7 hours ago         Exited              node-exporter             0                   eb7bbd6b1a3ae</span>
</span></span><span class="line"><span class="cl"><span class="na">a159a4a2cd630       85c4a186478c5       8 hours ago         Exited              cni-server                0                   ec18d4951aa24</span>
</span></span><span class="line"><span class="cl"><span class="na">311fb8d9d0915       85c4a186478c5       8 hours ago         Exited              kube-ovn-monitor          0                   29e23e19475f7</span>
</span></span><span class="line"><span class="cl"><span class="na">4994420dd49cd       85c4a186478c5       8 hours ago         Exited              openvswitch               0                   6aaa39b688767</span>
</span></span><span class="line"><span class="cl"><span class="na">316775dc2b0d5       85c4a186478c5       8 hours ago         Exited              ovn-central               0                   c557b57114e97</span>
</span></span><span class="line"><span class="cl"><span class="na">4d0c8a21aa3e2       2ae1ba6417cbc       8 hours ago         Exited              kube-proxy                0                   c2c23e8e506c4</span>
</span></span><span class="line"><span class="cl"><span class="na">32a274d36691e       3a5aa3a515f5d       8 hours ago         Exited              kube-scheduler            3                   35d60f66a07aa</span>
</span></span><span class="line"><span class="cl"><span class="na">018b4015ebb34       aebe758cef4cd       8 hours ago         Exited              etcd                      2                   21485439d6399</span>
</span></span><span class="line"><span class="cl"><span class="na">c4d4d3a7e0f99       d521dd763e2e3       8 hours ago         Exited              kube-apiserver            2                   6eb81ac0c0503</span>
</span></span><span class="line"><span class="cl"><span class="na">a9eeb491d46f9       586c112956dfc       8 hours ago         Exited              kube-controller-manager   2                   5802cc6895738</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="7-k8såˆ é™¤åç§°ç©ºé—´æŠ¥é”™">7. <strong>k8såˆ é™¤åç§°ç©ºé—´æŠ¥é”™</strong></h1>
<p><strong>ä¸€ç›´å¤„äºTerminatingçŠ¶æ€ä¸­</strong></p>
<ul>
<li>é—®é¢˜</li>
</ul>
<p>åˆ é™¤nsï¼Œä¸€ç›´å¤„äºTerminatingçŠ¶æ€ä¸­
å¼ºåˆ¶åˆ é™¤ä¹Ÿæ˜¯å‡ºç°æŠ¥é”™</p>
<p>åŸå› ï¼šå› ä¸ºingress controllerçš„é•œåƒ pull å¤±è´¥ï¼Œä¸€ç›´åœ¨ retry ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ ingress-controller delete æ‰ï¼Œä½†æ˜¯ä¸€ç›´å¡ä½åœ¨åˆ é™¤ namespace é˜¶æ®µ Ctrl + c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="na">[root@master1 ingress]# kubectl create -f mandatory.yaml</span>
</span></span><span class="line"><span class="cl"><span class="na">clusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole created</span>
</span></span><span class="line"><span class="cl"><span class="na">clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-clusterrole-nisa-binding created</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (AlreadyExists): error when creating &#34;mandatory.yaml&#34;: object is being deleted: namespaces &#34;ingress-ngin                                                               x&#34; already exists</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: configmaps &#34;nginx-configuration&#34; is forbidden: unable                                                                to create new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: configmaps &#34;tcp-services&#34; is forbidden: unable to cre                                                               ate new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: configmaps &#34;udp-services&#34; is forbidden: unable to cre                                                               ate new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: serviceaccounts &#34;nginx-ingress-serviceaccount&#34; is for                                                               bidden: unable to create new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: roles.rbac.authorization.k8s.io &#34;nginx-ingress-role&#34;                                                                is forbidden: unable to create new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: rolebindings.rbac.authorization.k8s.io &#34;nginx-ingress                                                               -role-nisa-binding&#34; is forbidden: unable to create new content in namespace ingress-nginx because it is being terminated</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">Error from server (Forbidden): error when creating &#34;mandatory.yaml&#34;: daemonsets.apps &#34;nginx-ingress-controller&#34; is forbidd                                                               en: unable to create new content in namespace ingress-nginx because it is being terminated</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è§£å†³æ–¹æ¡ˆï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get ns ingress-nginx -o json &gt; tmp.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¼å‡ºè¿è¡Œçš„åç§°ç©ºé—´è‡³jsonæ–‡ä»¶ï¼Œåˆ æ‰å…¶ä¸­çš„specå­—æ®µ<code>å†…å®¹</code>ï¼Œå› ä¸ºk8sé›†ç¾¤æ˜¯æºå¸¦è®¤è¯çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master1 ingress<span class="o">]</span><span class="c1"># kubectl proxy --port=8081</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ–°å¼€ä¸€ä¸ªshellç»ˆç«¯æ‰§è¡Œcurlå‘½ä»¤</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># curl -k -H &#34;Content-Type: application/json&#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8081/api/v1/namespaces/ingress-nginx/finalize</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ok</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master1 ingress]# kubectl get ns
</span></span><span class="line"><span class="cl">NAME                   STATUS        AGE
</span></span><span class="line"><span class="cl">default                Active        7d20h
</span></span><span class="line"><span class="cl">kube-node-lease        Active        7d20h
</span></span><span class="line"><span class="cl">kube-public            Active        7d20h
</span></span><span class="line"><span class="cl">kube-system            Active        7d20h
</span></span><span class="line"><span class="cl">kubernetes-dashboard   Terminating   7d14h
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="8-k8så¸¸ç”¨å‘½ä»¤">8. k8så¸¸ç”¨å‘½ä»¤</h1>
<h2 id="æŸ¥çœ‹æ‰€æœ‰-pod-åˆ—è¡¨---n-åè·Ÿ-namespace-æŸ¥çœ‹æŒ‡å®šçš„å‘½åç©ºé—´"><strong>æŸ¥çœ‹æ‰€æœ‰</strong> <strong>pod</strong> <strong>åˆ—è¡¨,  -n</strong> <strong>åè·Ÿ</strong> <strong>namespace,</strong> <strong>æŸ¥çœ‹æŒ‡å®šçš„å‘½åç©ºé—´</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> 
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">kube</span><span class="o">-</span><span class="nx">system</span>    <span class="err">#</span><span class="nx">æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´çš„pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">wide</span>    <span class="err">#</span><span class="nx">æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</span><span class="err">ï¼Œ</span><span class="nx">æ¯”å¦‚podæ‰€åœ¨èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="o">--</span><span class="nx">show</span><span class="o">-</span><span class="nx">labels</span>    <span class="err">#</span><span class="nx">è·å–podå¹¶æŸ¥çœ‹podçš„æ ‡ç­¾</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹-rc-å’Œ-service-åˆ—è¡¨--o-wide-æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"><strong>æŸ¥çœ‹</strong> <strong>RC</strong> <strong>å’Œ</strong> <strong>service</strong> <strong>åˆ—è¡¨ï¼Œ</strong> <strong>-o wide</strong> <strong>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">rc</span><span class="p">,</span><span class="nx">svc</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span><span class="p">,</span><span class="nx">svc</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">wide</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="o">&lt;</span><span class="nx">pod</span> <span class="nx">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ˜¾ç¤º-node-çš„è¯¦ç»†ä¿¡æ¯"><strong>æ˜¾ç¤º</strong> <strong>Node</strong> <strong>çš„è¯¦ç»†ä¿¡æ¯</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">describe</span> <span class="nx">node</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.212</span> <span class="err">#</span><span class="nx">å¯ä»¥è·ŸNode</span> <span class="nx">IPæˆ–è€…ä¸»æœºå</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ˜¾ç¤º-pod-çš„è¯¦ç»†ä¿¡æ¯-ç‰¹åˆ«æ˜¯æŸ¥çœ‹-pod-æ— æ³•åˆ›å»ºçš„æ—¶å€™çš„æ—¥å¿—"><strong>æ˜¾ç¤º</strong> <strong>Pod</strong> <strong>çš„è¯¦ç»†ä¿¡æ¯,</strong> <strong>ç‰¹åˆ«æ˜¯æŸ¥çœ‹</strong> <strong>pod</strong> <strong>æ— æ³•åˆ›å»ºçš„æ—¶å€™çš„æ—¥å¿—</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">describe</span> <span class="nx">pod</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nx">eg</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">describe</span> <span class="nx">pod</span> <span class="nx">redis</span><span class="o">-</span><span class="nx">master</span><span class="o">-</span><span class="nx">tqds9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ ¹æ®-yaml-åˆ›å»ºèµ„æº-apply-å¯ä»¥é‡å¤æ‰§è¡Œcreate-ä¸è¡Œ"><strong>æ ¹æ®</strong> <strong>yaml</strong> <strong>åˆ›å»ºèµ„æº, apply</strong> <strong>å¯ä»¥é‡å¤æ‰§è¡Œï¼Œcreate</strong> <strong>ä¸è¡Œ</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">create</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">yaml</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åŸºäº-podyaml-å®šä¹‰çš„åç§°åˆ é™¤æŒ‡å®šèµ„æº"><strong>åŸºäº pod.yaml</strong> <strong>å®šä¹‰çš„åç§°åˆ é™¤æŒ‡å®šèµ„æº</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">yaml</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ é™¤æ‰€æœ‰åŒ…å«æŸä¸ª-label-çš„pod-å’Œ-service"><strong>åˆ é™¤æ‰€æœ‰åŒ…å«æŸä¸ª</strong> <strong>label</strong> <strong>çš„pod</strong> <strong>å’Œ</strong> <strong>service</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="nx">pod</span><span class="p">,</span><span class="nx">svc</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=&lt;</span><span class="nx">label</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ é™¤é»˜è®¤å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰-pod"><strong>åˆ é™¤é»˜è®¤å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰</strong> <strong>Pod</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="nx">pod</span> <span class="o">--</span><span class="nx">all</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ‰§è¡Œ-pod-å‘½ä»¤"><strong>æ‰§è¡Œ</strong> <strong>pod</strong> <strong>å‘½ä»¤</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="o">--</span> <span class="nx">date</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="o">--</span> <span class="nx">bash</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="o">--</span> <span class="nx">ping</span> <span class="mf">10.24</span><span class="p">.</span><span class="mf">51.9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é€šè¿‡bashè·å¾—-pod-ä¸­æŸä¸ªå®¹å™¨httpscloudtencentcomproducttkefrom10680çš„ttyç›¸å½“äºç™»å½•å®¹å™¨"><strong>é€šè¿‡bashè·å¾—</strong> <strong>pod</strong> <strong>ä¸­æŸä¸ª</strong><a class="link" href="https://cloud.tencent.com/product/tke?from=10680"  target="_blank" rel="noopener"
    ><strong>å®¹å™¨</strong></a><strong>çš„TTYï¼Œç›¸å½“äºç™»å½•å®¹å™¨</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="o">-</span><span class="nx">it</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">c</span> <span class="o">&lt;</span><span class="nx">container</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="o">--</span> <span class="nx">bash</span>
</span></span><span class="line"><span class="cl"><span class="nx">eg</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="o">-</span><span class="nx">it</span> <span class="nx">redis</span><span class="o">-</span><span class="nx">master</span><span class="o">-</span><span class="nx">cln81</span> <span class="o">--</span> <span class="nx">bash</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"><strong>æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">f</span> <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span> <span class="err">#</span> <span class="nx">å®æ—¶æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">log</span>  <span class="o">&lt;</span><span class="nx">pod</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>  <span class="o">-</span><span class="nx">c</span> <span class="o">&lt;</span><span class="nx">container_name</span><span class="o">&gt;</span> <span class="err">#</span> <span class="nx">è‹¥</span> <span class="nx">pod</span> <span class="nx">åªæœ‰ä¸€ä¸ªå®¹å™¨</span><span class="err">ï¼Œ</span><span class="nx">å¯ä»¥ä¸åŠ </span> <span class="o">-</span><span class="nx">c</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">app</span><span class="o">=</span><span class="nx">frontend</span> <span class="err">#</span> <span class="nx">è¿”å›æ‰€æœ‰æ ‡è®°ä¸º</span> <span class="nx">app</span><span class="o">=</span><span class="nx">frontend</span> <span class="nx">çš„</span> <span class="nx">pod</span> <span class="nx">çš„åˆå¹¶æ—¥å¿—</span><span class="err">ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹èŠ‚ç‚¹-labels"><strong>æŸ¥çœ‹èŠ‚ç‚¹</strong> <strong>labels</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">node</span> <span class="o">--</span><span class="nx">show</span><span class="o">-</span><span class="nx">labels</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é‡å¯-pod"><strong>é‡å¯</strong> <strong>pod</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="o">&lt;</span><span class="nx">PODåç§°</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">n</span> <span class="o">&lt;</span><span class="nx">NAMESPACEåç§°</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">yaml</span> <span class="o">|</span> <span class="nx">kubectl</span> <span class="nx">replace</span> <span class="o">--</span><span class="nx">force</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ›å»ºå‘½ä»¤"><strong>åˆ›å»ºå‘½ä»¤</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">manifest</span><span class="p">.</span><span class="nx">yaml</span>           <span class="err">#</span> <span class="nx">åˆ›å»ºèµ„æº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">my1</span><span class="p">.</span><span class="nx">yaml</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">my2</span><span class="p">.</span><span class="nx">yaml</span>     <span class="err">#</span> <span class="nx">ä½¿ç”¨å¤šä¸ªæ–‡ä»¶åˆ›å»º</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">dir</span>                        <span class="err">#</span> <span class="nx">åŸºäºç›®å½•ä¸‹çš„æ‰€æœ‰æ¸…å•æ–‡ä»¶åˆ›å»ºèµ„æº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//git.io/vPieo         # ä» URL ä¸­åˆ›å»ºèµ„æº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">kubectl</span> <span class="nx">create</span> <span class="nx">deployment</span> <span class="nx">nginx</span> <span class="o">--</span><span class="nx">image</span><span class="o">=</span><span class="nx">nginx</span> <span class="err">#</span> <span class="nx">å¯åŠ¨å•å®ä¾‹</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">explain</span> <span class="nx">pods</span><span class="p">,</span><span class="nx">svc</span>                      <span class="err">#</span> <span class="nx">è·å–</span> <span class="nx">pod</span> <span class="nx">æ¸…å•çš„æ–‡æ¡£è¯´æ˜</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">ä»æ ‡å‡†è¾“å…¥åˆ›å»ºå¤šä¸ª</span> <span class="nx">YAML</span> <span class="nx">å¯¹è±¡</span>
</span></span><span class="line"><span class="cl"><span class="nx">cat</span> <span class="o">&lt;&lt;</span><span class="nx">EOF</span> <span class="o">|</span> <span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="nx">apiVersion</span><span class="o">:</span> <span class="nx">v1</span>
</span></span><span class="line"><span class="cl"><span class="nx">kind</span><span class="o">:</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">metadata</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="nx">busybox</span><span class="o">-</span><span class="nx">sleep</span>
</span></span><span class="line"><span class="cl"><span class="nx">spec</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">containers</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">busybox</span>
</span></span><span class="line"><span class="cl">    <span class="nx">image</span><span class="o">:</span> <span class="nx">busybox</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span> <span class="nx">sleep</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span> <span class="s2">&#34;1000000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">---</span>
</span></span><span class="line"><span class="cl"><span class="nx">apiVersion</span><span class="o">:</span> <span class="nx">v1</span>
</span></span><span class="line"><span class="cl"><span class="nx">kind</span><span class="o">:</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">metadata</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="nx">busybox</span><span class="o">-</span><span class="nx">sleep</span><span class="o">-</span><span class="nx">less</span>
</span></span><span class="line"><span class="cl"><span class="nx">spec</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">containers</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">busybox</span>
</span></span><span class="line"><span class="cl">    <span class="nx">image</span><span class="o">:</span> <span class="nx">busybox</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span> <span class="nx">sleep</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span> <span class="s2">&#34;1000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ›å»ºæœ‰å¤šä¸ª</span> <span class="nx">key</span> <span class="nx">çš„</span> <span class="nx">Secret</span>
</span></span><span class="line"><span class="cl"><span class="nx">cat</span> <span class="o">&lt;&lt;</span><span class="nx">EOF</span> <span class="o">|</span> <span class="nx">kubectl</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="nx">apiVersion</span><span class="o">:</span> <span class="nx">v1</span>
</span></span><span class="line"><span class="cl"><span class="nx">kind</span><span class="o">:</span> <span class="nx">Secret</span>
</span></span><span class="line"><span class="cl"><span class="nx">metadata</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="nx">mysecret</span>
</span></span><span class="line"><span class="cl"><span class="nx">type</span><span class="o">:</span> <span class="nx">Opaque</span>
</span></span><span class="line"><span class="cl"><span class="nx">data</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">password</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">echo</span> <span class="o">-</span><span class="nx">n</span> <span class="s2">&#34;s33msi4&#34;</span> <span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">w0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">username</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">echo</span> <span class="o">-</span><span class="nx">n</span> <span class="s2">&#34;jane&#34;</span> <span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">w0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹å’ŒæŸ¥æ‰¾èµ„æº"><strong>æŸ¥çœ‹å’ŒæŸ¥æ‰¾èµ„æº</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">get</span> <span class="nx">å‘½ä»¤çš„åŸºæœ¬è¾“å‡º</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">services</span>                          <span class="err">#</span> <span class="nx">åˆ—å‡ºå½“å‰å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰</span> <span class="nx">services</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">all</span><span class="o">-</span><span class="nx">namespaces</span>             <span class="err">#</span> <span class="nx">åˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„å…¨éƒ¨çš„</span> <span class="nx">Pods</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">wide</span>                      <span class="err">#</span> <span class="nx">åˆ—å‡ºå½“å‰å‘½åç©ºé—´ä¸‹çš„å…¨éƒ¨</span> <span class="nx">Pods</span><span class="err">ï¼Œ</span><span class="nx">å¹¶æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">deployment</span> <span class="nx">my</span><span class="o">-</span><span class="nx">dep</span>                 <span class="err">#</span> <span class="nx">åˆ—å‡ºæŸä¸ªç‰¹å®šçš„</span> <span class="nx">Deployment</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span>                              <span class="err">#</span> <span class="nx">åˆ—å‡ºå½“å‰å‘½åç©ºé—´ä¸‹çš„å…¨éƒ¨</span> <span class="nx">Pods</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">yaml</span>                <span class="err">#</span> <span class="nx">è·å–ä¸€ä¸ª</span> <span class="nx">pod</span> <span class="nx">çš„</span> <span class="nx">YAML</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">describe</span> <span class="nx">å‘½ä»¤çš„è¯¦ç»†è¾“å‡º</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">describe</span> <span class="nx">nodes</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">describe</span> <span class="nx">pods</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—å‡ºå½“å‰åå­—ç©ºé—´ä¸‹æ‰€æœ‰</span> <span class="nx">Services</span><span class="err">ï¼Œ</span><span class="nx">æŒ‰åç§°æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">services</span> <span class="o">--</span><span class="nx">sort</span><span class="o">-</span><span class="nx">by</span><span class="o">=</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—å‡º</span> <span class="nx">Pods</span><span class="err">ï¼Œ</span><span class="nx">æŒ‰é‡å¯æ¬¡æ•°æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">sort</span><span class="o">-</span><span class="nx">by</span><span class="o">=</span><span class="s1">&#39;.status.containerStatuses[0].restartCount&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—ä¸¾æ‰€æœ‰</span> <span class="nx">PV</span> <span class="nx">æŒä¹…å·</span><span class="err">ï¼Œ</span><span class="nx">æŒ‰å®¹é‡æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pv</span> <span class="o">--</span><span class="nx">sort</span><span class="o">-</span><span class="nx">by</span><span class="o">=</span><span class="p">.</span><span class="nx">spec</span><span class="p">.</span><span class="nx">capacity</span><span class="p">.</span><span class="nx">storage</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">è·å–åŒ…å«</span> <span class="nx">app</span><span class="o">=</span><span class="nx">cassandra</span> <span class="nx">æ ‡ç­¾çš„æ‰€æœ‰</span> <span class="nx">Pods</span> <span class="nx">çš„</span> <span class="nx">version</span> <span class="nx">æ ‡ç­¾</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">selector</span><span class="o">=</span><span class="nx">app</span><span class="o">=</span><span class="nx">cassandra</span> <span class="o">-</span><span class="nx">o</span> <span class="o">\</span>
</span></span><span class="line"><span class="cl">  <span class="nx">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].metadata.labels.version}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">è·å–æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹</span><span class="err">ï¼ˆ</span><span class="nx">ä½¿ç”¨é€‰æ‹©å™¨ä»¥æ’é™¤æ ‡ç­¾åç§°ä¸º</span> <span class="s1">&#39;node-role.kubernetes.io/master&#39;</span> <span class="nx">çš„ç»“æœ</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">node</span> <span class="o">--</span><span class="nx">selector</span><span class="o">=</span><span class="s1">&#39;!node-role.kubernetes.io/master&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">è·å–å½“å‰å‘½åç©ºé—´ä¸­æ­£åœ¨è¿è¡Œçš„</span> <span class="nx">Pods</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">field</span><span class="o">-</span><span class="nx">selector</span><span class="o">=</span><span class="nx">status</span><span class="p">.</span><span class="nx">phase</span><span class="o">=</span><span class="nx">Running</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">è·å–å…¨éƒ¨èŠ‚ç‚¹çš„</span> <span class="nx">ExternalIP</span> <span class="nx">åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">nodes</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].status.addresses[?(@.type==&#34;ExternalIP&#34;)].address}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—å‡ºå±äºæŸä¸ªç‰¹å®š</span> <span class="nx">RC</span> <span class="nx">çš„</span> <span class="nx">Pods</span> <span class="nx">çš„åç§°</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åœ¨è½¬æ¢å¯¹äº</span> <span class="nx">jsonpath</span> <span class="nx">è¿‡äºå¤æ‚çš„åœºåˆ</span><span class="err">ï¼Œ</span><span class="s2">&#34;jq&#34;</span> <span class="nx">å‘½ä»¤å¾ˆæœ‰ç”¨</span><span class="err">ï¼›</span><span class="nx">å¯ä»¥åœ¨</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//stedolan.github.io/jq/ æ‰¾åˆ°å®ƒã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sel</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">$</span><span class="p">(</span><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">rc</span> <span class="nx">my</span><span class="o">-</span><span class="nx">rc</span> <span class="o">--</span><span class="nx">output</span><span class="o">=</span><span class="nx">json</span> <span class="o">|</span> <span class="nx">jq</span> <span class="o">-</span><span class="nx">j</span> <span class="s1">&#39;.spec.selector | to_entries | .[] | &#34;\(.key)=\(.value),&#34;&#39;</span><span class="p">)</span><span class="o">%?</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">echo</span> <span class="nx">$</span><span class="p">(</span><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">selector</span><span class="o">=</span><span class="nx">$sel</span> <span class="o">--</span><span class="nx">output</span><span class="o">=</span><span class="nx">jsonpath</span><span class="o">=</span><span class="p">{.</span><span class="nx">items</span><span class="p">..</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">æ˜¾ç¤ºæ‰€æœ‰</span> <span class="nx">Pods</span> <span class="nx">çš„æ ‡ç­¾</span><span class="err">ï¼ˆ</span><span class="nx">æˆ–ä»»ä½•å…¶ä»–æ”¯æŒæ ‡ç­¾çš„</span> <span class="nx">Kubernetes</span> <span class="nx">å¯¹è±¡</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">show</span><span class="o">-</span><span class="nx">labels</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">æ£€æŸ¥å“ªäº›èŠ‚ç‚¹å¤„äºå°±ç»ªçŠ¶æ€</span>
</span></span><span class="line"><span class="cl"><span class="nx">JSONPATH</span><span class="o">=</span><span class="s1">&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;</span> <span class="o">\</span>
</span></span><span class="line"><span class="cl"> <span class="o">&amp;&amp;</span> <span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">nodes</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">jsonpath</span><span class="o">=</span><span class="s2">&#34;$JSONPATH&#34;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s2">&#34;Ready=True&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—å‡ºè¢«ä¸€ä¸ª</span> <span class="nx">Pod</span> <span class="nx">ä½¿ç”¨çš„å…¨éƒ¨</span> <span class="nx">Secret</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">json</span> <span class="o">|</span> <span class="nx">jq</span> <span class="s1">&#39;.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name&#39;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">v</span> <span class="kc">null</span> <span class="o">|</span> <span class="nx">sort</span> <span class="o">|</span> <span class="nx">uniq</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—ä¸¾æ‰€æœ‰</span> <span class="nx">Pods</span> <span class="nx">ä¸­åˆå§‹åŒ–å®¹å™¨çš„å®¹å™¨</span> <span class="nx">ID</span><span class="err">ï¼ˆ</span><span class="nx">containerID</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">Helpful</span> <span class="nx">when</span> <span class="nx">cleaning</span> <span class="nx">up</span> <span class="nx">stopped</span> <span class="nx">containers</span><span class="p">,</span> <span class="k">while</span> <span class="nx">avoiding</span> <span class="nx">removal</span> <span class="k">of</span> <span class="nx">initContainers</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">--</span><span class="nx">all</span><span class="o">-</span><span class="nx">namespaces</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">jsonpath</span><span class="o">=</span><span class="s1">&#39;{range .items[*].status.initContainerStatuses[*]}{.containerID}{&#34;\n&#34;}{end}&#39;</span> <span class="o">|</span> <span class="nx">cut</span> <span class="o">-</span><span class="nx">d</span><span class="o">/</span> <span class="o">-</span><span class="nx">f3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ—å‡ºäº‹ä»¶</span><span class="err">ï¼ˆ</span><span class="nx">Events</span><span class="err">ï¼‰ï¼Œ</span><span class="nx">æŒ‰æ—¶é—´æˆ³æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">events</span> <span class="o">--</span><span class="nx">sort</span><span class="o">-</span><span class="nx">by</span><span class="o">=</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">creationTimestamp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">æ¯”è¾ƒå½“å‰çš„é›†ç¾¤çŠ¶æ€å’Œå‡å®šæŸæ¸…å•è¢«åº”ç”¨ä¹‹åçš„é›†ç¾¤çŠ¶æ€</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">diff</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">manifest</span><span class="p">.</span><span class="nx">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ›´æ–°èµ„æº"><strong>æ›´æ–°èµ„æº</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">set</span> <span class="nx">image</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span> <span class="nx">www</span><span class="o">=</span><span class="nx">image</span><span class="o">:</span><span class="nx">v2</span>               <span class="err">#</span> <span class="nx">æ»šåŠ¨æ›´æ–°</span> <span class="s2">&#34;frontend&#34;</span> <span class="nx">Deployment</span> <span class="nx">çš„</span> <span class="s2">&#34;www&#34;</span> <span class="nx">å®¹å™¨é•œåƒ</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">rollout</span> <span class="nx">history</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span>                      <span class="err">#</span> <span class="nx">æ£€æŸ¥</span> <span class="nx">Deployment</span> <span class="nx">çš„å†å²è®°å½•</span><span class="err">ï¼Œ</span><span class="nx">åŒ…æ‹¬ç‰ˆæœ¬</span> 
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">rollout</span> <span class="nx">undo</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span>                         <span class="err">#</span> <span class="nx">å›æ»šåˆ°ä¸Šæ¬¡éƒ¨ç½²ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">rollout</span> <span class="nx">undo</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span> <span class="o">--</span><span class="nx">to</span><span class="o">-</span><span class="nx">revision</span><span class="o">=</span><span class="mi">2</span>         <span class="err">#</span> <span class="nx">å›æ»šåˆ°ç‰¹å®šéƒ¨ç½²ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">rollout</span> <span class="nx">status</span> <span class="o">-</span><span class="nx">w</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span>                    <span class="err">#</span> <span class="nx">ç›‘è§†</span> <span class="s2">&#34;frontend&#34;</span> <span class="nx">Deployment</span> <span class="nx">çš„æ»šåŠ¨å‡çº§çŠ¶æ€ç›´åˆ°å®Œæˆ</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">rollout</span> <span class="nx">restart</span> <span class="nx">deployment</span><span class="o">/</span><span class="nx">frontend</span>                      <span class="err">#</span> <span class="nx">è½®æ›¿é‡å¯</span> <span class="s2">&#34;frontend&#34;</span> <span class="nx">Deployment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">cat</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">json</span> <span class="o">|</span> <span class="nx">kubectl</span> <span class="nx">replace</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>                              <span class="err">#</span> <span class="nx">é€šè¿‡ä¼ å…¥åˆ°æ ‡å‡†è¾“å…¥çš„</span> <span class="nx">JSON</span> <span class="nx">æ¥æ›¿æ¢</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">å¼ºåˆ¶æ›¿æ¢</span><span class="err">ï¼Œ</span><span class="nx">åˆ é™¤åé‡å»ºèµ„æº</span><span class="err">ã€‚</span><span class="nx">ä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">replace</span> <span class="o">--</span><span class="nx">force</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">pod</span><span class="p">.</span><span class="nx">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">ä¸ºå¤šå‰¯æœ¬çš„</span> <span class="nx">nginx</span> <span class="nx">åˆ›å»ºæœåŠ¡</span><span class="err">ï¼Œ</span><span class="nx">ä½¿ç”¨</span> <span class="mi">80</span> <span class="nx">ç«¯å£æä¾›æœåŠ¡</span><span class="err">ï¼Œ</span><span class="nx">è¿æ¥åˆ°å®¹å™¨çš„</span> <span class="mi">8000</span> <span class="nx">ç«¯å£</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">expose</span> <span class="nx">rc</span> <span class="nx">nginx</span> <span class="o">--</span><span class="nx">port</span><span class="o">=</span><span class="mi">80</span> <span class="o">--</span><span class="nx">target</span><span class="o">-</span><span class="nx">port</span><span class="o">=</span><span class="mi">8000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">å°†æŸå•å®¹å™¨</span> <span class="nx">Pod</span> <span class="nx">çš„é•œåƒç‰ˆæœ¬</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡ç­¾</span><span class="err">ï¼‰</span><span class="nx">æ›´æ–°åˆ°</span> <span class="nx">v4</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pod</span> <span class="nx">mypod</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">yaml</span> <span class="o">|</span> <span class="nx">sed</span> <span class="s1">&#39;s/\(image: myimage\):.*$/\1:v4/&#39;</span> <span class="o">|</span> <span class="nx">kubectl</span> <span class="nx">replace</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">label</span> <span class="nx">pods</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="k">new</span><span class="o">-</span><span class="nx">label</span><span class="o">=</span><span class="nx">awesome</span>                      <span class="err">#</span> <span class="nx">æ·»åŠ æ ‡ç­¾</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">annotate</span> <span class="nx">pods</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="nx">icon</span><span class="o">-</span><span class="nx">url</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//goo.gl/XXBTWq       # æ·»åŠ æ³¨è§£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">kubectl</span> <span class="nx">autoscale</span> <span class="nx">deployment</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">min</span><span class="o">=</span><span class="mi">2</span> <span class="o">--</span><span class="nx">max</span><span class="o">=</span><span class="mi">10</span>                <span class="err">#</span> <span class="nx">å¯¹</span> <span class="s2">&#34;foo&#34;</span> <span class="nx">Deployment</span> <span class="nx">è‡ªåŠ¨ä¼¸ç¼©å®¹</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="éƒ¨åˆ†æ›´æ–°èµ„æº"><strong>éƒ¨åˆ†æ›´æ–°èµ„æº</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">éƒ¨åˆ†æ›´æ–°æŸèŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">patch</span> <span class="nx">node</span> <span class="nx">k8s</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="nx">p</span> <span class="s1">&#39;{&#34;spec&#34;:{&#34;unschedulable&#34;:true}}&#39;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">æ›´æ–°å®¹å™¨çš„é•œåƒ</span><span class="err">ï¼›</span><span class="nx">spec</span><span class="p">.</span><span class="nx">containers</span><span class="p">[</span><span class="o">*</span><span class="p">].</span><span class="nx">name</span> <span class="nx">æ˜¯å¿…é¡»çš„</span><span class="err">ã€‚</span><span class="nx">å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåˆå¹¶æ€§è´¨çš„ä¸»é”®</span><span class="err">ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">patch</span> <span class="nx">pod</span> <span class="nx">valid</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">p</span> <span class="s1">&#39;{&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;kubernetes-serve-hostname&#34;,&#34;image&#34;:&#34;new image&#34;}]}}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">ä½¿ç”¨å¸¦ä½ç½®æ•°ç»„çš„</span> <span class="nx">JSON</span> <span class="nx">patch</span> <span class="nx">æ›´æ–°å®¹å™¨çš„é•œåƒ</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">patch</span> <span class="nx">pod</span> <span class="nx">valid</span><span class="o">-</span><span class="nx">pod</span> <span class="o">--</span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="nx">p</span><span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/containers/0/image&#34;, &#34;value&#34;:&#34;new image&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">ä½¿ç”¨å¸¦ä½ç½®æ•°ç»„çš„</span> <span class="nx">JSON</span> <span class="nx">patch</span> <span class="nx">ç¦ç”¨æŸ</span> <span class="nx">Deployment</span> <span class="nx">çš„</span> <span class="nx">livenessProbe</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">valid</span><span class="o">-</span><span class="nx">deployment</span>  <span class="o">--</span><span class="nx">type</span> <span class="nx">json</span>   <span class="o">-</span><span class="nx">p</span><span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/livenessProbe&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åœ¨å¸¦ä½ç½®æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </span> 
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">patch</span> <span class="nx">sa</span> <span class="k">default</span> <span class="o">--</span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="nx">p</span><span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;add&#34;, &#34;path&#34;: &#34;/secrets/1&#34;, &#34;value&#34;: {&#34;name&#34;: &#34;whatever&#34; } }]&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ é™¤èµ„æº"><strong>åˆ é™¤èµ„æº</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="o">-</span><span class="nx">f</span> <span class="p">.</span><span class="o">/</span><span class="nx">pod</span><span class="p">.</span><span class="nx">json</span>                                              <span class="err">#</span> <span class="nx">åˆ é™¤åœ¨</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">json</span> <span class="nx">ä¸­æŒ‡å®šçš„ç±»å‹å’Œåç§°çš„</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="nx">pod</span><span class="p">,</span><span class="nx">service</span> <span class="nx">baz</span> <span class="nx">foo</span>                                        <span class="err">#</span> <span class="nx">åˆ é™¤åç§°ä¸º</span> <span class="s2">&#34;baz&#34;</span> <span class="nx">å’Œ</span> <span class="s2">&#34;foo&#34;</span> <span class="nx">çš„</span> <span class="nx">Pod</span> <span class="nx">å’ŒæœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="nx">pods</span><span class="p">,</span><span class="nx">services</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span>                              <span class="err">#</span> <span class="nx">åˆ é™¤åŒ…å«</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="nx">æ ‡ç­¾çš„</span> <span class="nx">pods</span> <span class="nx">å’ŒæœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="k">delete</span> <span class="nx">pods</span><span class="p">,</span><span class="nx">services</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="o">--</span><span class="nx">include</span><span class="o">-</span><span class="nx">uninitialized</span>      <span class="err">#</span> <span class="nx">åˆ é™¤åŒ…å«</span> <span class="nx">label</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="nx">æ ‡ç­¾çš„</span> <span class="nx">Pods</span> <span class="nx">å’ŒæœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">my</span><span class="o">-</span><span class="nx">ns</span> <span class="k">delete</span> <span class="nx">po</span><span class="p">,</span><span class="nx">svc</span> <span class="o">--</span><span class="nx">all</span>                                      <span class="err">#</span> <span class="nx">åˆ é™¤åœ¨</span> <span class="nx">my</span><span class="o">-</span><span class="nx">ns</span> <span class="nx">åå­—ç©ºé—´ä¸­å…¨éƒ¨çš„</span> <span class="nx">Pods</span> <span class="nx">å’ŒæœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">åˆ é™¤æ‰€æœ‰ä¸</span> <span class="nx">pattern1</span> <span class="nx">æˆ–</span> <span class="nx">pattern2</span> <span class="nx">awk</span> <span class="nx">æ¨¡å¼åŒ¹é…çš„</span> <span class="nx">Pods</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span>  <span class="o">-</span><span class="nx">n</span> <span class="nx">mynamespace</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">headers</span><span class="o">=</span><span class="kc">true</span> <span class="o">|</span> <span class="nx">awk</span> <span class="s1">&#39;/pattern1|pattern2/{print $1}&#39;</span> <span class="o">|</span> <span class="nx">xargs</span>  <span class="nx">kubectl</span> <span class="k">delete</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">mynamespace</span> <span class="nx">pod</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="podå¸¸ç”¨æ“ä½œ"><strong>Podå¸¸ç”¨æ“ä½œ</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span>                                 <span class="err">#</span> <span class="nx">è·å–</span> <span class="nx">pod</span> <span class="nx">æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span>                        <span class="err">#</span> <span class="nx">è·å–å«</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="nx">æ ‡ç­¾çš„</span> <span class="nx">Pods</span> <span class="nx">çš„æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">--</span><span class="nx">previous</span>                      <span class="err">#</span> <span class="nx">è·å–ä¸Šä¸ªå®¹å™¨å®ä¾‹çš„</span> <span class="nx">pod</span> <span class="nx">æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">my</span><span class="o">-</span><span class="nx">container</span>                 <span class="err">#</span> <span class="nx">è·å–</span> <span class="nx">Pod</span> <span class="nx">å®¹å™¨çš„æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="p">,</span> <span class="nx">å¤šå®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">my</span><span class="o">-</span><span class="nx">container</span>        <span class="err">#</span> <span class="nx">è·å–å«</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="nx">æ ‡ç­¾çš„</span> <span class="nx">Pod</span> <span class="nx">å®¹å™¨æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="p">,</span> <span class="nx">å¤šå®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">my</span><span class="o">-</span><span class="nx">container</span> <span class="o">--</span><span class="nx">previous</span>      <span class="err">#</span> <span class="nx">è·å–</span> <span class="nx">Pod</span> <span class="nx">ä¸­æŸå®¹å™¨çš„ä¸Šä¸ªå®ä¾‹çš„æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="p">,</span> <span class="nx">å¤šå®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span>                              <span class="err">#</span> <span class="nx">æµå¼è¾“å‡º</span> <span class="nx">Pod</span> <span class="nx">çš„æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">my</span><span class="o">-</span><span class="nx">container</span>              <span class="err">#</span> <span class="nx">æµå¼è¾“å‡º</span> <span class="nx">Pod</span> <span class="nx">å®¹å™¨çš„æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="p">,</span> <span class="nx">å¤šå®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">logs</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="o">--</span><span class="nx">all</span><span class="o">-</span><span class="nx">containers</span>    <span class="err">#</span> <span class="nx">æµå¼è¾“å‡ºå«</span> <span class="nx">name</span><span class="o">=</span><span class="nx">myLabel</span> <span class="nx">æ ‡ç­¾çš„</span> <span class="nx">Pod</span> <span class="nx">çš„æ‰€æœ‰æ—¥å¿—</span><span class="err">ï¼ˆ</span><span class="nx">æ ‡å‡†è¾“å‡º</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">run</span> <span class="o">-</span><span class="nx">i</span> <span class="o">--</span><span class="nx">tty</span> <span class="nx">busybox</span> <span class="o">--</span><span class="nx">image</span><span class="o">=</span><span class="nx">busybox</span> <span class="o">--</span> <span class="nx">sh</span>  <span class="err">#</span> <span class="nx">ä»¥äº¤äº’å¼</span> <span class="nx">Shell</span> <span class="nx">è¿è¡Œ</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">run</span> <span class="nx">nginx</span> <span class="o">--</span><span class="nx">image</span><span class="o">=</span><span class="nx">nginx</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">mynamespace</span>      <span class="err">#</span> <span class="nx">åœ¨æŒ‡å®šåå­—ç©ºé—´ä¸­è¿è¡Œ</span> <span class="nx">nginx</span> <span class="nx">Pod</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">run</span> <span class="nx">nginx</span> <span class="o">--</span><span class="nx">image</span><span class="o">=</span><span class="nx">nginx</span>                     <span class="err">#</span> <span class="nx">è¿è¡Œ</span> <span class="nx">ngins</span> <span class="nx">Pod</span> <span class="nx">å¹¶å°†å…¶è§„çº¦å†™å…¥åˆ°åä¸º</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">yaml</span> <span class="nx">çš„æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">  <span class="o">--</span><span class="nx">dry</span><span class="o">-</span><span class="nx">run</span><span class="o">=</span><span class="nx">client</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">yaml</span> <span class="o">&gt;</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">attach</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">i</span>                            <span class="err">#</span> <span class="nx">æŒ‚æ¥åˆ°ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ä¸­</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">port</span><span class="o">-</span><span class="nx">forward</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="mi">5000</span><span class="o">:</span><span class="mi">6000</span>               <span class="err">#</span> <span class="nx">åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šä¾¦å¬ç«¯å£</span> <span class="mi">5000</span> <span class="nx">å¹¶è½¬å‘åˆ°</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="nx">ä¸Šçš„ç«¯å£</span> <span class="mi">6000</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">--</span> <span class="nx">ls</span> <span class="o">/</span>                         <span class="err">#</span> <span class="nx">åœ¨å·²æœ‰çš„</span> <span class="nx">Pod</span> <span class="nx">ä¸­è¿è¡Œå‘½ä»¤</span><span class="err">ï¼ˆ</span><span class="nx">å•å®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">exec</span> <span class="nx">my</span><span class="o">-</span><span class="nx">pod</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">my</span><span class="o">-</span><span class="nx">container</span> <span class="o">--</span> <span class="nx">ls</span> <span class="o">/</span>         <span class="err">#</span> <span class="nx">åœ¨å·²æœ‰çš„</span> <span class="nx">Pod</span> <span class="nx">ä¸­è¿è¡Œå‘½ä»¤</span><span class="err">ï¼ˆ</span><span class="nx">å¤šå®¹å™¨åœºæ™¯</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">top</span> <span class="nx">pod</span> <span class="nx">POD_NAME</span> <span class="o">--</span><span class="nx">containers</span>               <span class="err">#</span> <span class="nx">æ˜¾ç¤ºç»™å®š</span> <span class="nx">Pod</span> <span class="nx">å’Œå…¶ä¸­å®¹å™¨çš„ç›‘æ§æ•°æ®</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="èŠ‚ç‚¹æ“ä½œ"><strong>èŠ‚ç‚¹æ“ä½œ</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">cordon</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span>                                                <span class="err">#</span> <span class="nx">æ ‡è®°</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span> <span class="nx">èŠ‚ç‚¹ä¸ºä¸å¯è°ƒåº¦</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">drain</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span>                                                 <span class="err">#</span> <span class="nx">å¯¹</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span> <span class="nx">èŠ‚ç‚¹è¿›è¡Œæ¸…ç©ºæ“ä½œ</span><span class="err">ï¼Œ</span><span class="nx">ä¸ºèŠ‚ç‚¹ç»´æŠ¤åšå‡†å¤‡</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">uncordon</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span>                                              <span class="err">#</span> <span class="nx">æ ‡è®°</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span> <span class="nx">èŠ‚ç‚¹ä¸ºå¯ä»¥è°ƒåº¦</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">top</span> <span class="nx">node</span> <span class="nx">my</span><span class="o">-</span><span class="nx">node</span>                                              <span class="err">#</span> <span class="nx">æ˜¾ç¤ºç»™å®šèŠ‚ç‚¹çš„åº¦é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">cluster</span><span class="o">-</span><span class="nx">info</span>                                                  <span class="err">#</span> <span class="nx">æ˜¾ç¤ºä¸»æ§èŠ‚ç‚¹å’ŒæœåŠ¡çš„åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">cluster</span><span class="o">-</span><span class="nx">info</span> <span class="nx">dump</span>                                             <span class="err">#</span> <span class="nx">å°†å½“å‰é›†ç¾¤çŠ¶æ€è½¬å‚¨åˆ°æ ‡å‡†è¾“å‡º</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">cluster</span><span class="o">-</span><span class="nx">info</span> <span class="nx">dump</span> <span class="o">--</span><span class="nx">output</span><span class="o">-</span><span class="nx">directory</span><span class="o">=</span><span class="err">/path/to/cluster-state   # å°†å½“å‰é›†ç¾¤çŠ¶æ€è¾“å‡ºåˆ° /path/to/cluster-state</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">å¦‚æœå·²å­˜åœ¨å…·æœ‰æŒ‡å®šé”®å’Œæ•ˆæœçš„æ±¡ç‚¹</span><span class="err">ï¼Œ</span><span class="nx">åˆ™æ›¿æ¢å…¶å€¼ä¸ºæŒ‡å®šå€¼</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">taint</span> <span class="nx">nodes</span> <span class="nx">foo</span> <span class="nx">dedicated</span><span class="o">=</span><span class="nx">special</span><span class="o">-</span><span class="nx">user</span><span class="o">:</span><span class="nx">NoSchedule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ ¼å¼åŒ–è¾“å‡º</strong></p>
<p>è¦ä»¥ç‰¹å®šæ ¼å¼å°†è¯¦ç»†ä¿¡æ¯è¾“å‡ºåˆ°ç»ˆç«¯çª—å£ï¼Œå¯ä»¥å°† -o æˆ– &ndash;output å‚æ•°æ·»åŠ åˆ°æ”¯æŒçš„ kubectl å‘½ä»¤</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">è¾“å‡ºæ ¼å¼</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-o=custom-columns=<spec></td>
<td style="text-align:left">ä½¿ç”¨é€—å·åˆ†éš”çš„è‡ªå®šä¹‰åˆ—æ¥æ‰“å°è¡¨æ ¼</td>
</tr>
<tr>
<td style="text-align:left">-o=custom-columns-file=<filename></td>
<td style="text-align:left">ä½¿ç”¨ <filename> æ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰åˆ—æ¨¡æ¿æ‰“å°è¡¨æ ¼</td>
</tr>
<tr>
<td style="text-align:left">-o=json</td>
<td style="text-align:left">è¾“å‡º JSON æ ¼å¼çš„ API å¯¹è±¡</td>
</tr>
<tr>
<td style="text-align:left">-o=jsonpath=<template></td>
<td style="text-align:left">æ‰“å° jsonpath è¡¨è¾¾å¼ä¸­å®šä¹‰çš„å­—æ®µ</td>
</tr>
<tr>
<td style="text-align:left">-o=jsonpath-file=<filename></td>
<td style="text-align:left">æ‰“å°åœ¨ <filename> æ–‡ä»¶ä¸­å®šä¹‰çš„ jsonpath è¡¨è¾¾å¼æ‰€æŒ‡å®šçš„å­—æ®µã€‚</td>
</tr>
<tr>
<td style="text-align:left">-o=name</td>
<td style="text-align:left">ä»…æ‰“å°èµ„æºåç§°è€Œä¸æ‰“å°å…¶ä»–å†…å®¹</td>
</tr>
<tr>
<td style="text-align:left">-o=wide</td>
<td style="text-align:left">ä»¥çº¯æ–‡æœ¬æ ¼å¼è¾“å‡ºé¢å¤–ä¿¡æ¯ï¼Œå¯¹äº Pod æ¥è¯´ï¼Œè¾“å‡ºä¸­åŒ…å«äº†èŠ‚ç‚¹åç§°</td>
</tr>
<tr>
<td style="text-align:left">-o=yaml</td>
<td style="text-align:left">è¾“å‡º YAML æ ¼å¼çš„ API å¯¹è±¡</td>
</tr>
</tbody>
</table></div>
<p>ä½¿ç”¨ -o=custom-columns çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">é›†ç¾¤ä¸­è¿è¡Œç€çš„æ‰€æœ‰é•œåƒ</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">o</span><span class="o">=</span><span class="nx">custom</span><span class="o">-</span><span class="nx">columns</span><span class="o">=</span><span class="s1">&#39;DATA:spec.containers[*].image&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">#</span> <span class="nx">é™¤</span> <span class="s2">&#34;k8s.gcr.io/coredns:1.6.2&#34;</span> <span class="nx">ä¹‹å¤–çš„æ‰€æœ‰é•œåƒ</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">o</span><span class="o">=</span><span class="nx">custom</span><span class="o">-</span><span class="nx">columns</span><span class="o">=</span><span class="s1">&#39;DATA:spec.containers[?(@.image!=&#34;k8s.gcr.io/coredns:1.6.2&#34;)].image&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nx">è¾“å‡º</span> <span class="nx">metadata</span> <span class="nx">ä¸‹é¢çš„æ‰€æœ‰å­—æ®µ</span><span class="err">ï¼Œ</span><span class="nx">æ— è®º</span> <span class="nx">Pod</span> <span class="nx">åå­—ä¸ºä½•</span>
</span></span><span class="line"><span class="cl"><span class="nx">kubectl</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">o</span><span class="o">=</span><span class="nx">custom</span><span class="o">-</span><span class="nx">columns</span><span class="o">=</span><span class="s1">&#39;DATA:metadata.*&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ndots-searchåŸŸ">ndots searchåŸŸ</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@centos-76f4b54bb5-tph8f /]# cat /etc/resolv.conf    
</span></span><span class="line"><span class="cl">search default.svc.cluster.local svc.cluster.local cluster.local
</span></span><span class="line"><span class="cl">nameserver 10.96.0.10
</span></span><span class="line"><span class="cl">options ndots:5
</span></span></code></pre></td></tr></table>
</div>
</div><p>ndotsä¿®æ”¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  namespace: default
</span></span><span class="line"><span class="cl">  name: dns-example
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">    - name: test
</span></span><span class="line"><span class="cl">      image: nginx
</span></span><span class="line"><span class="cl">  dnsConfig:
</span></span><span class="line"><span class="cl">    options:
</span></span><span class="line"><span class="cl">      - name: ndots
</span></span><span class="line"><span class="cl">        value: &#34;2&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="é™„ä»¶">é™„ä»¶ï¼š</h1>
<h3 id="ingress-nginx-serviceyaml">ingress-nginx-service.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: networking.k8s.io/v1
</span></span><span class="line"><span class="cl">kind: Ingress
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: ingress-nginx-service
</span></span><span class="line"><span class="cl">  namespace: ns-test
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    kubernetes.io/ingress.class: nginx
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  tls:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   - hosts:
</span></span><span class="line"><span class="cl">     - www.test.dev
</span></span><span class="line"><span class="cl">     - test.dev
</span></span><span class="line"><span class="cl">       secretName: tls-secret
</span></span><span class="line"><span class="cl">       rules:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  - host: www.test.dev
</span></span><span class="line"><span class="cl">    http:
</span></span><span class="line"><span class="cl">      paths:
</span></span><span class="line"><span class="cl">      - path: /
</span></span><span class="line"><span class="cl">        pathType: Prefix
</span></span><span class="line"><span class="cl">        backend:
</span></span><span class="line"><span class="cl">          service:
</span></span><span class="line"><span class="cl">            name: nginx-service
</span></span><span class="line"><span class="cl">            port:
</span></span><span class="line"><span class="cl">              number: 80
</span></span><span class="line"><span class="cl">  - host: test.dev
</span></span><span class="line"><span class="cl">    http:
</span></span><span class="line"><span class="cl">      paths:
</span></span><span class="line"><span class="cl">      - path: /
</span></span><span class="line"><span class="cl">        pathType: Prefix
</span></span><span class="line"><span class="cl">        backend:
</span></span><span class="line"><span class="cl">          service:
</span></span><span class="line"><span class="cl">            name: nginx-service
</span></span><span class="line"><span class="cl">            port:
</span></span><span class="line"><span class="cl">              number: 80
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ingress-grafana-prometheus-serviceyaml">ingress-grafana-prometheus-service.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-monitoring-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">grafana.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">alertmanager.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">prometheus.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">tls-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">foobar.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">&amp;http_rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">foobar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">api.foobar.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">*http_rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">admin.foobar.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">*http_rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">status.foobar.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">*http_rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus-k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">alertmanager.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">alertmanager-main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">9093</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">grafana.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginx-deploymentyaml">nginx-deployment.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginx-serviceyaml">nginx-service.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ns-test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="nginx-minioyaml">nginx-minio.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">tenant</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;on&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;HTTPS&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="p">:</span><span class="w"> </span><span class="l">1024m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-connect-timeout</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;300&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-send-timeout</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;300&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-read-timeout</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;300&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">apiminio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">web.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">api.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">&amp;web_minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tenant1-console</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">9443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">web.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">*web_minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">apiminio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">&amp;api_minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">minio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">api.minio.test.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="cp">*api_minio</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redis---rbacyaml">redis - rbac.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus-k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">operator-redis-ibm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus-k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus-k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prometheus-k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">operator-redis-ibm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">pods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">extensions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingresses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ingress-nginx-deploy-daemonsetyaml">ingress-nginx-deploy-daemonset.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span><span class="lnt">688
</span><span class="lnt">689
</span><span class="lnt">690
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">namespaces</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">configmaps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">pods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingresses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingresses/status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingressclasses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resourceNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingress-controller-leader</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">configmaps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">configmaps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">coordination.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resourceNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingress-controller-leader</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">leases</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">coordination.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">leases</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">events</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">configmaps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">nodes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">pods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">namespaces</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">coordination.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">leases</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">nodes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">services</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingresses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">events</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingresses/status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">ingressclasses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">watch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">admissionregistration.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">validatingwebhookconfigurations</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">get</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow-snippet-annotations</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">externalTrafficPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">appProtocol</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">appProtocol</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">appProtocol</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l">webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">minReadySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;10254&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/scrape</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">/nginx-ingress-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">election-id=ingress-controller-leader</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">controller-class=k8s.io/ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">ingress-class=nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook=:8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook-certificate=/usr/local/certificates/cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">validating-webhook-key=/usr/local/certificates/key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAMESPACE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">LD_PRELOAD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/lib/libmimalloc.so</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">anjia0532/google-containers.ingress-nginx.controller:v1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">/wait-shutdown</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/healthz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">90Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">add</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">NET_BIND_SERVICE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">101</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/local/certificates/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterFirst</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">edgenode</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">300</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webhook-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">batch/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission-create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission-create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">host=ingress-nginx-controller-admission,ingress-nginx-controller-admission.$(POD_NAMESPACE).svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">namespace=$(POD_NAMESPACE)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">secret-name=ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAMESPACE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">anjia0532/google-containers.ingress-nginx.kube-webhook-certgen:v1.1.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kubernetes.io/os</span><span class="p">:</span><span class="w"> </span><span class="l">linux</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="m">2000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">2000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">batch/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission-patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission-patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">webhook-name=ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">namespace=$(POD_NAMESPACE)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">patch-mutating=false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">secret-name=ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- --<span class="l">patch-failure-policy=Fail</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">POD_NAMESPACE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">anjia0532/google-containers.ingress-nginx.kube-webhook-certgen:v1.1.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">patch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kubernetes.io/os</span><span class="p">:</span><span class="w"> </span><span class="l">linux</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="m">2000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">2000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">IngressClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l">k8s.io/ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">admissionregistration.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ValidatingWebhookConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">admission-webhook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="m">1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">webhooks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">admissionReviewVersions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">clientConfig</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx-controller-admission</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/networking/v1/ingresses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">failurePolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Fail</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Equivalent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">validate.nginx.ingress.kubernetes.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">apiVersions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">operations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">CREATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">UPDATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ingresses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sideEffects</span><span class="p">:</span><span class="w"> </span><span class="l">None</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 Cyberzz Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.21.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
